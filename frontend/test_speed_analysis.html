<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¢å•é€Ÿåº¦åˆ†ææµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        .warning {
            color: #ffc107;
        }
        .info {
            color: #17a2b8;
        }
        .config-panel {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .config-group {
            margin-bottom: 10px;
        }
        .config-group label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        .config-group select, .config-group input {
            width: 200px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-online {
            background-color: #28a745;
        }
        .status-offline {
            background-color: #dc3545;
        }
        .status-unknown {
            background-color: #ffc107;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸš— è®¢å•é€Ÿåº¦åˆ†æåŠŸèƒ½æµ‹è¯•</h1>
    
    <!-- ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ -->
    <div class="test-container">
        <h2 class="test-title">ğŸ“Š ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h2>
        <div id="system-status">
            <p><span class="status-indicator status-unknown"></span>åç«¯æœåŠ¡çŠ¶æ€: <span id="backend-status">æ£€æŸ¥ä¸­...</span></p>
            <p><span class="status-indicator status-unknown"></span>APIè·¯ç”±çŠ¶æ€: <span id="api-status">æ£€æŸ¥ä¸­...</span></p>
            <p><span class="status-indicator status-unknown"></span>æ•°æ®åº“è¿æ¥: <span id="db-status">æ£€æŸ¥ä¸­...</span></p>
        </div>
        <button class="test-button" onclick="checkSystemStatus()">ğŸ” æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</button>
        <div id="status-result" class="result-box" style="display: none;"></div>
    </div>

    <!-- ç½‘ç»œè¿æ¥æµ‹è¯• -->
    <div class="test-container">
        <h2 class="test-title">ğŸŒ ç½‘ç»œè¿æ¥æµ‹è¯•</h2>
        <button class="test-button" onclick="testNetworkConnection()">ğŸ”— æµ‹è¯•ç½‘ç»œè¿æ¥</button>
        <button class="test-button" onclick="testCORS()">ğŸ”„ æµ‹è¯•CORSé…ç½®</button>
        <button class="test-button" onclick="testProxy()">ğŸ”€ æµ‹è¯•ä»£ç†é…ç½®</button>
        <div id="network-result" class="result-box" style="display: none;"></div>
    </div>

    <!-- APIæ¥å£æµ‹è¯• -->
    <div class="test-container">
        <h2 class="test-title">ğŸ”§ APIæ¥å£æµ‹è¯•</h2>
        <div class="config-panel">
            <div class="config-group">
                <label>åˆ†æèŒƒå›´:</label>
                <select id="include-short-medium">
                    <option value="true">ä»…ä¸­çŸ­é€”è®¢å•(â‰¤8km)</option>
                    <option value="false">å…¨éƒ¨è®¢å•</option>
                </select>
            </div>
            <div class="config-group">
                <label>ç©ºé—´åˆ†è¾¨ç‡:</label>
                <select id="spatial-resolution">
                    <option value="0.001">é«˜ç²¾åº¦(100m)</option>
                    <option value="0.005">ä¸­ç­‰(500m)</option>
                    <option value="0.01">ä½ç²¾åº¦(1km)</option>
                </select>
            </div>
            <div class="config-group">
                <label>æœ€å°è®¢å•æ•°:</label>
                <input type="number" id="min-orders" value="5" min="3" max="20">
            </div>
        </div>
        <button class="test-button" onclick="testBasicAPI()">ğŸ§ª åŸºç¡€APIæµ‹è¯•</button>
        <button class="test-button" onclick="testSpeedAnalysisAPI()">âš¡ é€Ÿåº¦åˆ†æAPIæµ‹è¯•</button>
        <button class="test-button" onclick="testWithDifferentParams()">ğŸ”„ å‚æ•°å˜åŒ–æµ‹è¯•</button>
        <div id="api-result" class="result-box" style="display: none;"></div>
    </div>

    <!-- æ•°æ®æ ¼å¼æµ‹è¯• -->
    <div class="test-container">
        <h2 class="test-title">ğŸ“‹ æ•°æ®æ ¼å¼æµ‹è¯•</h2>
        <button class="test-button" onclick="testDataFormat()">ğŸ“Š æµ‹è¯•æ•°æ®æ ¼å¼</button>
        <button class="test-button" onclick="validateResponse()">âœ… éªŒè¯å“åº”æ ¼å¼</button>
        <button class="test-button" onclick="testErrorHandling()">âŒ æµ‹è¯•é”™è¯¯å¤„ç†</button>
        <div id="data-result" class="result-box" style="display: none;"></div>
    </div>

    <!-- æ€§èƒ½æµ‹è¯• -->
    <div class="test-container">
        <h2 class="test-title">âš¡ æ€§èƒ½æµ‹è¯•</h2>
        <button class="test-button" onclick="testPerformance()">ğŸš€ æ€§èƒ½æµ‹è¯•</button>
        <button class="test-button" onclick="testConcurrency()">ğŸ”„ å¹¶å‘æµ‹è¯•</button>
        <button class="test-button" onclick="testTimeout()">â±ï¸ è¶…æ—¶æµ‹è¯•</button>
        <div id="performance-result" class="result-box" style="display: none;"></div>
    </div>

    <!-- å®Œæ•´åŠŸèƒ½æµ‹è¯• -->
    <div class="test-container">
        <h2 class="test-title">ğŸ¯ å®Œæ•´åŠŸèƒ½æµ‹è¯•</h2>
        <button class="test-button" onclick="runFullTest()">ğŸ”„ è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <button class="test-button" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
        <div id="full-test-result" class="result-box" style="display: none;"></div>
    </div>

    <script>
        // é…ç½®axiosé»˜è®¤è®¾ç½®
        axios.defaults.timeout = 30000; // 30ç§’è¶…æ—¶
        axios.defaults.baseURL = 'http://localhost:8082'; // å‰ç«¯å¼€å‘æœåŠ¡å™¨åœ°å€

        // å·¥å…·å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            return `<div class="${className}">[${timestamp}] ${message}</div>`;
        }

        function updateResult(elementId, content, append = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            if (append) {
                element.innerHTML += content;
            } else {
                element.innerHTML = content;
            }
        }

        function getConfig() {
            return {
                include_short_medium_only: document.getElementById('include-short-medium').value === 'true',
                spatial_resolution: parseFloat(document.getElementById('spatial-resolution').value),
                min_orders_per_location: parseInt(document.getElementById('min-orders').value)
            };
        }

        // ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
        async function checkSystemStatus() {
            let result = log('å¼€å§‹ç³»ç»ŸçŠ¶æ€æ£€æŸ¥...', 'info');
            updateResult('status-result', result);

            try {
                // æ£€æŸ¥åç«¯æœåŠ¡
                result += log('æ£€æŸ¥åç«¯æœåŠ¡ (http://localhost:8000)...', 'info');
                updateResult('status-result', result);

                const backendResponse = await axios.get('/api/traffic/summary');
                result += log(`âœ… åç«¯æœåŠ¡æ­£å¸¸ (çŠ¶æ€ç : ${backendResponse.status})`, 'success');
                document.getElementById('backend-status').innerHTML = 'âœ… åœ¨çº¿';
                document.querySelector('#system-status .status-indicator').className = 'status-indicator status-online';

                // æ£€æŸ¥APIè·¯ç”±
                result += log('æ£€æŸ¥APIè·¯ç”±...', 'info');
                const routeResponse = await axios.get('/api/traffic/files/info');
                result += log(`âœ… APIè·¯ç”±æ­£å¸¸`, 'success');
                document.getElementById('api-status').innerHTML = 'âœ… æ­£å¸¸';

                updateResult('status-result', result);

            } catch (error) {
                result += log(`âŒ ç³»ç»Ÿæ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                if (error.response) {
                    result += log(`HTTPçŠ¶æ€: ${error.response.status}`, 'error');
                    result += log(`å“åº”æ•°æ®: ${JSON.stringify(error.response.data)}`, 'error');
                }
                document.getElementById('backend-status').innerHTML = 'âŒ ç¦»çº¿';
                document.querySelector('#system-status .status-indicator').className = 'status-indicator status-offline';
                updateResult('status-result', result);
            }
        }

        // ç½‘ç»œè¿æ¥æµ‹è¯•
        async function testNetworkConnection() {
            let result = log('å¼€å§‹ç½‘ç»œè¿æ¥æµ‹è¯•...', 'info');
            updateResult('network-result', result);

            const tests = [
                { name: 'æœ¬åœ°åç«¯', url: '/api/traffic/summary' },
                { name: 'ç›´æ¥åç«¯', url: 'http://localhost:8000/api/traffic/summary' },
                { name: 'å¥åº·æ£€æŸ¥', url: '/api/traffic/files/info' }
            ];

            for (const test of tests) {
                try {
                    result += log(`æµ‹è¯• ${test.name}: ${test.url}`, 'info');
                    const startTime = Date.now();
                    const response = await axios.get(test.url);
                    const endTime = Date.now();
                    result += log(`âœ… ${test.name} æˆåŠŸ (${endTime - startTime}ms, çŠ¶æ€: ${response.status})`, 'success');
                } catch (error) {
                    result += log(`âŒ ${test.name} å¤±è´¥: ${error.message}`, 'error');
                }
                updateResult('network-result', result);
            }
        }

        // CORSæµ‹è¯•
        async function testCORS() {
            let result = log('å¼€å§‹CORSé…ç½®æµ‹è¯•...', 'info');
            updateResult('network-result', result, true);

            try {
                const response = await axios.options('/api/traffic/summary');
                result += log(`âœ… CORSé¢„æ£€è¯·æ±‚æˆåŠŸ`, 'success');
                result += log(`CORSå¤´ä¿¡æ¯: ${JSON.stringify(response.headers)}`, 'info');
            } catch (error) {
                result += log(`âŒ CORSæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            updateResult('network-result', result, true);
        }

        // ä»£ç†æµ‹è¯•
        async function testProxy() {
            let result = log('å¼€å§‹ä»£ç†é…ç½®æµ‹è¯•...', 'info');
            updateResult('network-result', result, true);

            try {
                // æµ‹è¯•ä»£ç†æ˜¯å¦æ­£ç¡®è½¬å‘è¯·æ±‚
                const response = await axios.get('/api/traffic/summary', {
                    headers: {
                        'X-Test-Proxy': 'true'
                    }
                });
                result += log(`âœ… ä»£ç†è½¬å‘æˆåŠŸ`, 'success');
                result += log(`å“åº”æ¥æº: ${response.headers['server'] || 'æœªçŸ¥'}`, 'info');
            } catch (error) {
                result += log(`âŒ ä»£ç†æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            updateResult('network-result', result, true);
        }

        // åŸºç¡€APIæµ‹è¯•
        async function testBasicAPI() {
            let result = log('å¼€å§‹åŸºç¡€APIæµ‹è¯•...', 'info');
            updateResult('api-result', result);

            const basicAPIs = [
                { name: 'äº¤é€šæ¦‚è¦', url: '/api/traffic/summary' },
                { name: 'æ–‡ä»¶ä¿¡æ¯', url: '/api/traffic/files/info' },
                { name: 'è·¯æ®µä¿¡æ¯', url: '/api/traffic/road/segments' }
            ];

            for (const api of basicAPIs) {
                try {
                    result += log(`æµ‹è¯• ${api.name}: ${api.url}`, 'info');
                    const response = await axios.get(api.url);
                    result += log(`âœ… ${api.name} API æ­£å¸¸`, 'success');
                    result += log(`æ•°æ®å¤§å°: ${JSON.stringify(response.data).length} å­—ç¬¦`, 'info');
                } catch (error) {
                    result += log(`âŒ ${api.name} API å¤±è´¥: ${error.message}`, 'error');
                }
                updateResult('api-result', result);
            }
        }

        // é€Ÿåº¦åˆ†æAPIæµ‹è¯•
        async function testSpeedAnalysisAPI() {
            let result = log('å¼€å§‹é€Ÿåº¦åˆ†æAPIæµ‹è¯•...', 'info');
            updateResult('api-result', result, true);

            const config = getConfig();
            result += log(`æµ‹è¯•é…ç½®: ${JSON.stringify(config, null, 2)}`, 'info');

            try {
                const startTime = 1378944000;  // 2013-09-12 00:00:00 UTC
                const endTime = 1379548799;    // 2013-09-18 23:59:59 UTC
                const url = `/api/traffic/road/order-speed-analysis?start_time=${startTime}&end_time=${endTime}`;
                
                result += log(`è¯·æ±‚URL: ${url}`, 'info');
                result += log(`è¯·æ±‚æ–¹æ³•: POST`, 'info');
                result += log(`è¯·æ±‚ä½“: ${JSON.stringify(config, null, 2)}`, 'info');

                const requestStart = Date.now();
                const response = await axios.post(url, config);
                const requestEnd = Date.now();

                result += log(`âœ… é€Ÿåº¦åˆ†æAPIè°ƒç”¨æˆåŠŸ!`, 'success');
                result += log(`è¯·æ±‚è€—æ—¶: ${requestEnd - requestStart}ms`, 'info');
                result += log(`å“åº”çŠ¶æ€: ${response.status}`, 'success');
                result += log(`å“åº”æ•°æ®ç»“æ„:`, 'info');
                result += `<pre>${JSON.stringify(response.data, null, 2)}</pre>`;

                // éªŒè¯å“åº”æ•°æ®ç»“æ„
                if (response.data.success) {
                    result += log(`âœ… åˆ†ææˆåŠŸ: ${response.data.message}`, 'success');
                    if (response.data.speed_analysis) {
                        const analysis = response.data.speed_analysis;
                        result += log(`ğŸ“Š åˆ†æç»“æœç»Ÿè®¡:`, 'info');
                        result += log(`  - é€Ÿåº¦æ•°æ®ç‚¹: ${analysis.speed_data?.length || 0}`, 'info');
                        result += log(`  - çƒ­åŠ›å›¾æ•°æ®: ${analysis.heatmap_data?.length || 0}`, 'info');
                        result += log(`  - æ‹¥å µæ‘˜è¦: ${Object.keys(analysis.congestion_summary || {}).length} é¡¹`, 'info');
                    }
                } else {
                    result += log(`âš ï¸ åˆ†æå¤±è´¥: ${response.data.message}`, 'warning');
                }

            } catch (error) {
                result += log(`âŒ é€Ÿåº¦åˆ†æAPIæµ‹è¯•å¤±è´¥!`, 'error');
                result += log(`é”™è¯¯ç±»å‹: ${error.constructor.name}`, 'error');
                result += log(`é”™è¯¯æ¶ˆæ¯: ${error.message}`, 'error');
                
                if (error.response) {
                    result += log(`HTTPçŠ¶æ€ç : ${error.response.status}`, 'error');
                    result += log(`å“åº”æ•°æ®: ${JSON.stringify(error.response.data, null, 2)}`, 'error');
                } else if (error.request) {
                    result += log(`è¯·æ±‚å¯¹è±¡: ${error.request}`, 'error');
                    result += log(`è¯·æ±‚çŠ¶æ€: ${error.request.readyState}`, 'error');
                } else {
                    result += log(`é…ç½®é”™è¯¯: ${error.message}`, 'error');
                }
            }

            updateResult('api-result', result, true);
        }

        // å‚æ•°å˜åŒ–æµ‹è¯•
        async function testWithDifferentParams() {
            let result = log('å¼€å§‹å‚æ•°å˜åŒ–æµ‹è¯•...', 'info');
            updateResult('api-result', result, true);

            const testConfigs = [
                { name: 'é«˜ç²¾åº¦çŸ­é€”', include_short_medium_only: true, spatial_resolution: 0.001, min_orders_per_location: 3 },
                { name: 'ä¸­ç­‰ç²¾åº¦å…¨éƒ¨', include_short_medium_only: false, spatial_resolution: 0.005, min_orders_per_location: 5 },
                { name: 'ä½ç²¾åº¦é«˜é˜ˆå€¼', include_short_medium_only: true, spatial_resolution: 0.01, min_orders_per_location: 10 }
            ];

            for (const config of testConfigs) {
                try {
                    result += log(`æµ‹è¯•é…ç½®: ${config.name}`, 'info');
                    result += log(`å‚æ•°: ${JSON.stringify(config, null, 2)}`, 'info');

                    const startTime = 1378944000;
                    const endTime = 1379548799;
                    const url = `/api/traffic/road/order-speed-analysis?start_time=${startTime}&end_time=${endTime}`;
                    
                    const requestStart = Date.now();
                    const response = await axios.post(url, config);
                    const requestEnd = Date.now();

                    result += log(`âœ… ${config.name} æµ‹è¯•æˆåŠŸ (${requestEnd - requestStart}ms)`, 'success');
                    
                    if (response.data.success && response.data.speed_analysis) {
                        const analysis = response.data.speed_analysis;
                        result += log(`  ç»“æœ: ${analysis.speed_data?.length || 0} ä¸ªé€Ÿåº¦ç‚¹`, 'info');
                    }

                } catch (error) {
                    result += log(`âŒ ${config.name} æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
                updateResult('api-result', result, true);
            }
        }

        // æ•°æ®æ ¼å¼æµ‹è¯•
        async function testDataFormat() {
            let result = log('å¼€å§‹æ•°æ®æ ¼å¼æµ‹è¯•...', 'info');
            updateResult('data-result', result);

            try {
                const config = getConfig();
                const startTime = 1378944000;
                const endTime = 1379548799;
                const url = `/api/traffic/road/order-speed-analysis?start_time=${startTime}&end_time=${endTime}`;
                
                const response = await axios.post(url, config);
                
                result += log('éªŒè¯å“åº”æ•°æ®æ ¼å¼...', 'info');
                
                // æ£€æŸ¥åŸºæœ¬ç»“æ„
                const data = response.data;
                if (typeof data === 'object' && data !== null) {
                    result += log('âœ… å“åº”æ˜¯æœ‰æ•ˆçš„JSONå¯¹è±¡', 'success');
                } else {
                    result += log('âŒ å“åº”ä¸æ˜¯æœ‰æ•ˆçš„JSONå¯¹è±¡', 'error');
                }

                // æ£€æŸ¥å¿…éœ€å­—æ®µ
                const requiredFields = ['success', 'message'];
                for (const field of requiredFields) {
                    if (field in data) {
                        result += log(`âœ… åŒ…å«å¿…éœ€å­—æ®µ: ${field}`, 'success');
                    } else {
                        result += log(`âŒ ç¼ºå°‘å¿…éœ€å­—æ®µ: ${field}`, 'error');
                    }
                }

                // æ£€æŸ¥æ•°æ®ç»“æ„
                if (data.speed_analysis) {
                    result += log('âœ… åŒ…å«é€Ÿåº¦åˆ†ææ•°æ®', 'success');
                    const analysis = data.speed_analysis;
                    
                    if (Array.isArray(analysis.speed_data)) {
                        result += log(`âœ… é€Ÿåº¦æ•°æ®æ˜¯æ•°ç»„ (${analysis.speed_data.length} é¡¹)`, 'success');
                    } else {
                        result += log('âŒ é€Ÿåº¦æ•°æ®ä¸æ˜¯æ•°ç»„', 'error');
                    }
                    
                    if (Array.isArray(analysis.heatmap_data)) {
                        result += log(`âœ… çƒ­åŠ›å›¾æ•°æ®æ˜¯æ•°ç»„ (${analysis.heatmap_data.length} é¡¹)`, 'success');
                    } else {
                        result += log('âŒ çƒ­åŠ›å›¾æ•°æ®ä¸æ˜¯æ•°ç»„', 'error');
                    }
                }

            } catch (error) {
                result += log(`âŒ æ•°æ®æ ¼å¼æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }

            updateResult('data-result', result);
        }

        // æ€§èƒ½æµ‹è¯•
        async function testPerformance() {
            let result = log('å¼€å§‹æ€§èƒ½æµ‹è¯•...', 'info');
            updateResult('performance-result', result);

            const config = getConfig();
            const startTime = 1378944000;
            const endTime = 1379548799;
            const url = `/api/traffic/road/order-speed-analysis?start_time=${startTime}&end_time=${endTime}`;

            const testCount = 5;
            const times = [];

            for (let i = 0; i < testCount; i++) {
                try {
                    result += log(`æ‰§è¡Œç¬¬ ${i + 1} æ¬¡æ€§èƒ½æµ‹è¯•...`, 'info');
                    const requestStart = Date.now();
                    const response = await axios.post(url, config);
                    const requestEnd = Date.now();
                    const duration = requestEnd - requestStart;
                    times.push(duration);
                    result += log(`ç¬¬ ${i + 1} æ¬¡: ${duration}ms`, 'info');
                } catch (error) {
                    result += log(`ç¬¬ ${i + 1} æ¬¡æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
                updateResult('performance-result', result);
            }

            if (times.length > 0) {
                const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
                const minTime = Math.min(...times);
                const maxTime = Math.max(...times);
                
                result += log(`ğŸ“Š æ€§èƒ½ç»Ÿè®¡:`, 'info');
                result += log(`  å¹³å‡å“åº”æ—¶é—´: ${avgTime.toFixed(2)}ms`, 'info');
                result += log(`  æœ€å¿«å“åº”æ—¶é—´: ${minTime}ms`, 'info');
                result += log(`  æœ€æ…¢å“åº”æ—¶é—´: ${maxTime}ms`, 'info');
                
                if (avgTime < 5000) {
                    result += log(`âœ… æ€§èƒ½è‰¯å¥½ (å¹³å‡ < 5ç§’)`, 'success');
                } else if (avgTime < 10000) {
                    result += log(`âš ï¸ æ€§èƒ½ä¸€èˆ¬ (å¹³å‡ 5-10ç§’)`, 'warning');
                } else {
                    result += log(`âŒ æ€§èƒ½è¾ƒå·® (å¹³å‡ > 10ç§’)`, 'error');
                }
            }

            updateResult('performance-result', result);
        }

        // è¿è¡Œå®Œæ•´æµ‹è¯•
        async function runFullTest() {
            const result = log('ğŸš€ å¼€å§‹è¿è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•...', 'info');
            updateResult('full-test-result', result);

            const tests = [
                { name: 'ç³»ç»ŸçŠ¶æ€æ£€æŸ¥', func: checkSystemStatus },
                { name: 'ç½‘ç»œè¿æ¥æµ‹è¯•', func: testNetworkConnection },
                { name: 'åŸºç¡€APIæµ‹è¯•', func: testBasicAPI },
                { name: 'é€Ÿåº¦åˆ†æAPIæµ‹è¯•', func: testSpeedAnalysisAPI },
                { name: 'æ•°æ®æ ¼å¼æµ‹è¯•', func: testDataFormat },
                { name: 'æ€§èƒ½æµ‹è¯•', func: testPerformance }
            ];

            for (const test of tests) {
                try {
                    updateResult('full-test-result', log(`æ‰§è¡Œ ${test.name}...`, 'info'), true);
                    await test.func();
                    updateResult('full-test-result', log(`âœ… ${test.name} å®Œæˆ`, 'success'), true);
                } catch (error) {
                    updateResult('full-test-result', log(`âŒ ${test.name} å¤±è´¥: ${error.message}`, 'error'), true);
                }
            }

            updateResult('full-test-result', log('ğŸ‰ å®Œæ•´æµ‹è¯•ç»“æŸ!', 'info'), true);
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            const resultElements = document.querySelectorAll('.result-box');
            resultElements.forEach(element => {
                element.style.display = 'none';
                element.innerHTML = '';
            });
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        window.onload = function() {
            setTimeout(checkSystemStatus, 1000);
        };
    </script>
</body>
</html> 