{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, onMounted, onUnmounted, watch, nextTick } from 'vue';\nimport { MapPin } from 'lucide-vue-next';\nexport default {\n  __name: 'TrafficMapPanel',\n  props: {\n    data: {\n      type: Array,\n      default: () => []\n    },\n    viewType: {\n      type: String,\n      default: 'distribution'\n    },\n    mapStyle: {\n      type: String,\n      default: 'blue'\n    },\n    loading: {\n      type: Boolean,\n      default: false\n    },\n    vehicleId: {\n      type: String,\n      default: ''\n    }\n  },\n  emits: ['update:viewType', 'update:mapStyle'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n\n    // 生成唯一的地图容器ID - 使用更复杂的ID避免冲突\n    const mapContainerId = `amap-container-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    const mapContainer = ref(null);\n    // 地图实例\n    let mapInstance = null;\n    let currentHeatmap = null; // 存储当前热力图实例\n    const mapLoaded = ref(false);\n    const loadingMessage = ref('正在加载高德地图API...');\n\n    // 地图风格\n    const mapStyleOptions = {\n      normal: 'amap://styles/normal',\n      dark: 'amap://styles/dark',\n      light: 'amap://styles/light',\n      whitesmoke: 'amap://styles/whitesmoke',\n      fresh: 'amap://styles/fresh',\n      blue: 'amap://styles/blue',\n      darkblue: 'amap://styles/darkblue'\n    };\n\n    // 地图风格选项\n    const mapStyles = [{\n      key: 'normal',\n      name: '标准地图'\n    }, {\n      key: 'dark',\n      name: '暗色地图'\n    }, {\n      key: 'light',\n      name: '亮色地图'\n    }, {\n      key: 'whitesmoke',\n      name: '浅灰地图'\n    }, {\n      key: 'fresh',\n      name: '清新地图'\n    }, {\n      key: 'blue',\n      name: '蓝色地图'\n    }, {\n      key: 'darkblue',\n      name: '深蓝地图'\n    }];\n\n    // 当前地图风格\n    const currentMapStyle = ref(props.mapStyle || 'blue');\n\n    // 当前地图视图\n    const currentMapView = ref(props.viewType || 'distribution');\n\n    // 地图视图选项\n    const mapViews = [{\n      key: 'distribution',\n      name: '分布视图'\n    }, {\n      key: 'trajectory',\n      name: '轨迹视图'\n    }, {\n      key: 'heatmap',\n      name: '热力图'\n    }];\n\n    // 视图对应的默认风格\n    const viewStyleMap = {\n      distribution: 'blue',\n      trajectory: 'dark',\n      heatmap: 'darkblue'\n    };\n\n    // 异步加载高德地图API\n    function loadAMapScript() {\n      return new Promise((resolve, reject) => {\n        if (window.AMap) {\n          resolve(window.AMap);\n          return;\n        }\n        loadingMessage.value = '正在加载高德地图API...';\n        const script = document.createElement('script');\n        script.type = 'text/javascript';\n        script.async = true;\n        script.src = 'https://webapi.amap.com/maps?v=2.0&key=ac9b745946df9aee02cf0515319407df&callback=initAMap';\n\n        // 创建全局回调函数\n        window.initAMap = () => {\n          resolve(window.AMap);\n          delete window.initAMap;\n        };\n        script.onerror = () => {\n          reject(new Error('高德地图API加载失败'));\n          loadingMessage.value = '地图API加载失败，请刷新重试';\n        };\n        document.head.appendChild(script);\n      });\n    }\n\n    // 初始化地图\n    async function initMap() {\n      try {\n        // 检查容器是否存在\n        if (!mapContainer.value) {\n          console.error('地图容器不存在');\n          loadingMessage.value = '地图容器不存在，请刷新页面';\n          return;\n        }\n\n        // 如果地图实例已存在，先销毁\n        if (mapInstance) {\n          console.log('销毁现有地图实例');\n          mapInstance.destroy();\n          mapInstance = null;\n          currentHeatmap = null;\n        }\n\n        // 确保高德地图API已加载\n        if (!window.AMap) {\n          loadingMessage.value = '正在加载高德地图API...';\n          await loadAMapScript();\n        }\n        loadingMessage.value = '正在初始化地图...';\n        console.log(`正在初始化地图，容器ID: ${mapContainerId}`);\n\n        // 等待下一个tick确保DOM完全渲染\n        await nextTick();\n\n        // 再次检查容器\n        const containerElement = document.getElementById(mapContainerId);\n        if (!containerElement) {\n          console.error(`找不到地图容器: ${mapContainerId}`);\n          loadingMessage.value = '地图容器初始化失败';\n          return;\n        }\n\n        // 创建地图实例\n        mapInstance = new window.AMap.Map(mapContainerId, {\n          center: [117.120, 36.651],\n          // 济南市中心\n          zoom: 8,\n          // 缩放级别\n          viewMode: '2D',\n          // 2D模式\n          mapStyle: mapStyleOptions[currentMapStyle.value],\n          // 添加配置项解决Canvas警告\n          features: ['bg', 'road', 'building', 'point'],\n          // 禁用某些可能导致Canvas问题的功能\n          doubleClickZoom: false,\n          // 设置地图渲染模式\n          renderMode: 'canvas'\n        });\n\n        // 添加地图控件\n        mapInstance.plugin(['AMap.ToolBar', 'AMap.Scale'], function () {\n          mapInstance.addControl(new window.AMap.ToolBar());\n          mapInstance.addControl(new window.AMap.Scale());\n        });\n\n        // 监听地图加载完成事件\n        mapInstance.on('complete', function () {\n          console.log('地图加载完成');\n          mapLoaded.value = true;\n          // 根据当前视图类型更新地图\n          updateMapByViewType(currentMapView.value);\n        });\n\n        // 监听地图错误事件\n        mapInstance.on('error', function (error) {\n          console.error('地图加载错误:', error);\n          loadingMessage.value = '地图加载错误，请刷新重试';\n        });\n      } catch (error) {\n        console.error('地图初始化失败:', error);\n        loadingMessage.value = '地图初始化失败，请刷新重试';\n      }\n    }\n\n    // 根据视图类型更新地图\n    function updateMapByViewType(viewType) {\n      if (!mapInstance) return;\n\n      // 根据视图类型设置默认风格\n      if (viewStyleMap[viewType]) {\n        currentMapStyle.value = viewStyleMap[viewType];\n        mapInstance.setMapStyle(mapStyleOptions[currentMapStyle.value]);\n      }\n\n      // 根据不同视图类型执行不同操作\n      switch (viewType) {\n        case 'distribution':\n          // 分布视图逻辑\n          renderDistributionView();\n          break;\n        case 'trajectory':\n          // 轨迹视图逻辑\n          renderTrajectoryView();\n          break;\n        case 'heatmap':\n          // 热力图视图逻辑\n          renderHeatmapView();\n          break;\n      }\n    }\n\n    // 切换地图风格\n    function changeMapStyle(styleKey) {\n      if (!mapInstance) return;\n      currentMapStyle.value = styleKey;\n      mapInstance.setMapStyle(mapStyleOptions[styleKey]);\n      emit('update:mapStyle', styleKey);\n    }\n\n    // 分布视图渲染\n    function renderDistributionView() {\n      if (!mapInstance || !props.data || !props.data.length) return;\n\n      // 清除已有标记\n      mapInstance.clearMap();\n\n      // 添加点标记\n      props.data.forEach(item => {\n        const lat = item.lat || item.latitude;\n        const lng = item.lng || item.longitude;\n        if (lat && lng) {\n          new window.AMap.Marker({\n            position: [lng, lat],\n            map: mapInstance,\n            icon: new window.AMap.Icon({\n              size: new window.AMap.Size(6, 6),\n              image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSI2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxjaXJjbGUgY3g9IjMiIGN5PSIzIiByPSIzIiBmaWxsPSIjMDBjZmZmIi8+PC9zdmc+',\n              imageSize: new window.AMap.Size(6, 6)\n            })\n          });\n        }\n      });\n    }\n\n    // 轨迹视图渲染\n    function renderTrajectoryView() {\n      if (!mapInstance || !props.data || !props.data.length) return;\n\n      // 清除已有标记\n      mapInstance.clearMap();\n\n      // 如果有指定车辆ID，绘制该车辆轨迹\n      if (props.vehicleId) {\n        const vehicleData = props.data.filter(item => item.vehicleId === props.vehicleId || item.vehicle_id === props.vehicleId).sort((a, b) => {\n          const timeA = a.timestamp || a.UTC || 0;\n          const timeB = b.timestamp || b.UTC || 0;\n          return timeA - timeB;\n        });\n        if (vehicleData.length > 1) {\n          // 创建轨迹路径\n          const path = vehicleData.map(item => {\n            const lng = item.lng || item.longitude;\n            const lat = item.lat || item.latitude;\n            return [lng, lat];\n          });\n\n          // 绘制轨迹线\n          const polyline = new window.AMap.Polyline({\n            path: path,\n            strokeColor: '#00cfff',\n            strokeWeight: 4,\n            strokeOpacity: 0.8,\n            showDir: true\n          });\n          mapInstance.add(polyline);\n\n          // 添加起点和终点标记\n          const startMarker = new window.AMap.Marker({\n            position: path[0],\n            map: mapInstance,\n            icon: new window.AMap.Icon({\n              size: new window.AMap.Size(25, 34),\n              imageSize: new window.AMap.Size(25, 34),\n              image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png'\n            })\n          });\n          const endMarker = new window.AMap.Marker({\n            position: path[path.length - 1],\n            map: mapInstance,\n            icon: new window.AMap.Icon({\n              size: new window.AMap.Size(25, 34),\n              imageSize: new window.AMap.Size(25, 34),\n              image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-spot.png'\n            })\n          });\n\n          // 自适应缩放级别\n          mapInstance.setFitView([polyline, startMarker, endMarker]);\n        }\n      }\n    }\n\n    // 热力图视图渲染\n    function renderHeatmapView() {\n      if (!mapInstance || !props.data || !props.data.length) return;\n\n      // 清除已有标记和热力图\n      mapInstance.clearMap();\n      if (currentHeatmap) {\n        currentHeatmap.setMap(null);\n        currentHeatmap = null;\n      }\n\n      // 准备热力图数据\n      const heatmapData = props.data.map(item => {\n        const lng = item.lng || item.longitude;\n        const lat = item.lat || item.latitude;\n        const count = item.count || item.speed || 1;\n        return {\n          lng: lng,\n          lat: lat,\n          count: count\n        };\n      }).filter(item => item.lng && item.lat); // 过滤掉无效数据\n\n      if (heatmapData.length === 0) {\n        console.warn('没有有效的热力图数据');\n        return;\n      }\n\n      // 加载热力图插件\n      mapInstance.plugin(['AMap.HeatMap'], function () {\n        try {\n          // 创建热力图实例\n          currentHeatmap = new window.AMap.HeatMap(mapInstance, {\n            radius: 25,\n            opacity: [0, 0.8],\n            gradient: {\n              0.5: 'blue',\n              0.65: 'rgb(117,211,248)',\n              0.7: 'rgb(0,255,0)',\n              0.9: 'yellow',\n              1.0: 'red'\n            },\n            // 添加配置减少Canvas警告\n            blur: 0.85,\n            zooms: [3, 18]\n          });\n\n          // 设置热力图数据\n          currentHeatmap.setDataSet({\n            data: heatmapData,\n            max: Math.max(...heatmapData.map(item => item.count))\n          });\n          console.log(`热力图渲染完成，共 ${heatmapData.length} 个点`);\n        } catch (error) {\n          console.error('热力图渲染失败:', error);\n        }\n      });\n    }\n\n    // 切换地图视图\n    function changeMapView(viewType) {\n      currentMapView.value = viewType;\n      emit('update:viewType', viewType);\n      updateMapByViewType(viewType);\n    }\n\n    // 定位到山东省\n    function centerToShandong() {\n      if (mapInstance) {\n        mapInstance.setZoomAndCenter(7, [118.000, 36.400]);\n      }\n    }\n\n    // 定位到济南市\n    function centerToJinan() {\n      if (mapInstance) {\n        mapInstance.setZoomAndCenter(11, [117.120, 36.651]);\n      }\n    }\n\n    // 监听视图类型变化\n    watch(() => props.viewType, newView => {\n      if (mapInstance && newView) {\n        currentMapView.value = newView;\n        updateMapByViewType(newView);\n      }\n    });\n\n    // 监听地图风格变化\n    watch(() => props.mapStyle, newStyle => {\n      if (mapInstance && newStyle) {\n        currentMapStyle.value = newStyle;\n        mapInstance.setMapStyle(mapStyleOptions[newStyle]);\n      }\n    });\n\n    // 监听交通数据变化\n    watch(() => props.data, newData => {\n      if (mapInstance && newData && newData.length > 0) {\n        updateMapByViewType(currentMapView.value);\n      }\n    }, {\n      deep: true\n    });\n\n    // 组件挂载时初始化地图\n    onMounted(async () => {\n      console.log('TrafficMapPanel 组件已挂载');\n\n      // 等待DOM完全渲染\n      await nextTick();\n\n      // 再等待一个短暂的时间确保所有样式都应用完成\n      setTimeout(async () => {\n        console.log('开始初始化地图');\n        await initMap();\n      }, 100); // 减少等待时间，但确保DOM已经渲染\n    });\n\n    // 组件卸载时销毁地图\n    onUnmounted(() => {\n      console.log('TrafficMapPanel 组件已卸载');\n\n      // 清理热力图实例\n      if (currentHeatmap) {\n        try {\n          currentHeatmap.setMap(null);\n        } catch (error) {\n          console.warn('清理热力图失败:', error);\n        }\n        currentHeatmap = null;\n      }\n\n      // 清理地图实例\n      if (mapInstance) {\n        try {\n          mapInstance.clearMap();\n          mapInstance.destroy();\n        } catch (error) {\n          console.warn('销毁地图实例失败:', error);\n        }\n        mapInstance = null;\n      }\n\n      // 重置状态\n      mapLoaded.value = false;\n    });\n    const __returned__ = {\n      props,\n      emit,\n      mapContainerId,\n      mapContainer,\n      get mapInstance() {\n        return mapInstance;\n      },\n      set mapInstance(v) {\n        mapInstance = v;\n      },\n      get currentHeatmap() {\n        return currentHeatmap;\n      },\n      set currentHeatmap(v) {\n        currentHeatmap = v;\n      },\n      mapLoaded,\n      loadingMessage,\n      mapStyleOptions,\n      mapStyles,\n      currentMapStyle,\n      currentMapView,\n      mapViews,\n      viewStyleMap,\n      loadAMapScript,\n      initMap,\n      updateMapByViewType,\n      changeMapStyle,\n      renderDistributionView,\n      renderTrajectoryView,\n      renderHeatmapView,\n      changeMapView,\n      centerToShandong,\n      centerToJinan,\n      ref,\n      onMounted,\n      onUnmounted,\n      watch,\n      nextTick,\n      get MapPin() {\n        return MapPin;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","watch","nextTick","MapPin","props","__props","emit","__emit","mapContainerId","Date","now","Math","random","toString","substr","mapContainer","mapInstance","currentHeatmap","mapLoaded","loadingMessage","mapStyleOptions","normal","dark","light","whitesmoke","fresh","blue","darkblue","mapStyles","key","name","currentMapStyle","mapStyle","currentMapView","viewType","mapViews","viewStyleMap","distribution","trajectory","heatmap","loadAMapScript","Promise","resolve","reject","window","AMap","value","script","document","createElement","type","async","src","initAMap","onerror","Error","head","appendChild","initMap","console","error","log","destroy","containerElement","getElementById","Map","center","zoom","viewMode","features","doubleClickZoom","renderMode","plugin","addControl","ToolBar","Scale","on","updateMapByViewType","setMapStyle","renderDistributionView","renderTrajectoryView","renderHeatmapView","changeMapStyle","styleKey","data","length","clearMap","forEach","item","lat","latitude","lng","longitude","Marker","position","map","icon","Icon","size","Size","image","imageSize","vehicleId","vehicleData","filter","vehicle_id","sort","a","b","timeA","timestamp","UTC","timeB","path","polyline","Polyline","strokeColor","strokeWeight","strokeOpacity","showDir","add","startMarker","endMarker","setFitView","setMap","heatmapData","count","speed","warn","HeatMap","radius","opacity","gradient","blur","zooms","setDataSet","max","changeMapView","centerToShandong","setZoomAndCenter","centerToJinan","newView","newStyle","newData","deep","setTimeout"],"sources":["E:/hhh/frontend/src/modules/trafficVisualization/TrafficMapPanel.vue"],"sourcesContent":["<template>\r\n  <div class=\"card-tech p-6\">\r\n    <div class=\"flex items-center justify-between mb-4\">\r\n      <h2 class=\"text-xl font-semibold text-white flex items-center\">\r\n        <MapPin class=\"h-5 w-5 mr-2 text-cyan-400\" />\r\n        交通分布地图\r\n      </h2>\r\n      <div class=\"flex space-x-2\">\r\n        <button \r\n          v-for=\"view in mapViews\" \r\n          :key=\"view.key\"\r\n          @click=\"changeMapView(view.key)\"\r\n          :class=\"[\r\n            'px-3 py-1 rounded-lg text-sm transition-colors duration-300',\r\n            currentMapView === view.key \r\n              ? 'bg-cyan-500 text-white' \r\n              : 'bg-blue-900 text-blue-200 hover:bg-blue-800'\r\n          ]\"\r\n        >\r\n          {{ view.name }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- 地图风格选择器 -->\r\n    <div class=\"mb-4 flex flex-wrap gap-2\">\r\n      <button \r\n        v-for=\"style in mapStyles\" \r\n        :key=\"style.key\"\r\n        @click=\"changeMapStyle(style.key)\"\r\n        :class=\"[\r\n          'px-2 py-1 rounded text-xs transition-colors duration-300',\r\n          currentMapStyle === style.key \r\n            ? 'bg-cyan-500 text-white' \r\n            : 'bg-blue-900 text-blue-200 hover:bg-blue-800'\r\n        ]\"\r\n      >\r\n        {{ style.name }}\r\n      </button>\r\n    </div>\r\n    \r\n    <!-- 地图容器 -->\r\n    <div class=\"relative\">\r\n      <div \r\n        :id=\"mapContainerId\" \r\n        ref=\"mapContainer\"\r\n        class=\"rounded-lg overflow-hidden border border-blue-800\"\r\n        style=\"min-height: 600px; width: 100%; height: 600px;\"\r\n      ></div>\r\n      \r\n      <!-- 地图状态信息 -->\r\n      <div v-if=\"mapLoaded\" class=\"absolute top-4 left-4 bg-blue-900/80 rounded-lg p-3 text-white text-sm\">\r\n        <div class=\"flex items-center mb-1\">\r\n          <div class=\"w-2 h-2 rounded-full bg-green-400 mr-2\"></div>\r\n          <span>地图已加载</span>\r\n        </div>\r\n        <div v-if=\"data && data.length > 0\">\r\n          <p>找到 {{ data.length }} 条数据</p>\r\n          <p class=\"text-blue-200 text-xs\">{{ vehicleId ? '车辆轨迹模式' : '区域分布模式' }}</p>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- 地图控制按钮 -->\r\n      <div class=\"absolute top-4 right-4 flex flex-col space-y-2\">\r\n        <button \r\n          @click=\"centerToShandong\"\r\n          class=\"bg-blue-900/80 hover:bg-blue-800 text-white text-sm py-1 px-3 rounded-lg\"\r\n        >\r\n          查看山东省\r\n        </button>\r\n        <button \r\n          @click=\"centerToJinan\"\r\n          class=\"bg-blue-900/80 hover:bg-blue-800 text-white text-sm py-1 px-3 rounded-lg\"\r\n        >\r\n          查看济南市\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- 加载中状态 -->\r\n      <div v-if=\"loading || !mapLoaded\" class=\"absolute inset-0 flex items-center justify-center bg-blue-950/50\">\r\n        <div class=\"text-center\">\r\n          <div class=\"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-cyan-500 mb-4\"></div>\r\n          <p class=\"text-cyan-400\">{{ loadingMessage }}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, onUnmounted, watch, nextTick } from 'vue'\r\nimport { MapPin } from 'lucide-vue-next'\r\n\r\nconst props = defineProps({\r\n  data: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  viewType: {\r\n    type: String,\r\n    default: 'distribution'\r\n  },\r\n  mapStyle: {\r\n    type: String,\r\n    default: 'blue'\r\n  },\r\n  loading: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  vehicleId: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n})\r\n\r\nconst emit = defineEmits(['update:viewType', 'update:mapStyle'])\r\n\r\n// 生成唯一的地图容器ID - 使用更复杂的ID避免冲突\r\nconst mapContainerId = `amap-container-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\r\nconst mapContainer = ref(null)\r\n// 地图实例\r\nlet mapInstance = null\r\nlet currentHeatmap = null // 存储当前热力图实例\r\nconst mapLoaded = ref(false)\r\nconst loadingMessage = ref('正在加载高德地图API...')\r\n\r\n// 地图风格\r\nconst mapStyleOptions = {\r\n  normal: 'amap://styles/normal',\r\n  dark: 'amap://styles/dark',\r\n  light: 'amap://styles/light',\r\n  whitesmoke: 'amap://styles/whitesmoke',\r\n  fresh: 'amap://styles/fresh',\r\n  blue: 'amap://styles/blue',\r\n  darkblue: 'amap://styles/darkblue'\r\n}\r\n\r\n// 地图风格选项\r\nconst mapStyles = [\r\n  { key: 'normal', name: '标准地图' },\r\n  { key: 'dark', name: '暗色地图' },\r\n  { key: 'light', name: '亮色地图' },\r\n  { key: 'whitesmoke', name: '浅灰地图' },\r\n  { key: 'fresh', name: '清新地图' },\r\n  { key: 'blue', name: '蓝色地图' },\r\n  { key: 'darkblue', name: '深蓝地图' }\r\n]\r\n\r\n// 当前地图风格\r\nconst currentMapStyle = ref(props.mapStyle || 'blue')\r\n\r\n// 当前地图视图\r\nconst currentMapView = ref(props.viewType || 'distribution')\r\n\r\n// 地图视图选项\r\nconst mapViews = [\r\n  { key: 'distribution', name: '分布视图' },\r\n  { key: 'trajectory', name: '轨迹视图' },\r\n  { key: 'heatmap', name: '热力图' }\r\n]\r\n\r\n// 视图对应的默认风格\r\nconst viewStyleMap = {\r\n  distribution: 'blue',\r\n  trajectory: 'dark',\r\n  heatmap: 'darkblue'\r\n}\r\n\r\n// 异步加载高德地图API\r\nfunction loadAMapScript() {\r\n  return new Promise((resolve, reject) => {\r\n    if (window.AMap) {\r\n      resolve(window.AMap)\r\n      return\r\n    }\r\n\r\n    loadingMessage.value = '正在加载高德地图API...'\r\n    const script = document.createElement('script')\r\n    script.type = 'text/javascript'\r\n    script.async = true\r\n    script.src = 'https://webapi.amap.com/maps?v=2.0&key=ac9b745946df9aee02cf0515319407df&callback=initAMap'\r\n    \r\n    // 创建全局回调函数\r\n    window.initAMap = () => {\r\n      resolve(window.AMap)\r\n      delete window.initAMap\r\n    }\r\n    \r\n    script.onerror = () => {\r\n      reject(new Error('高德地图API加载失败'))\r\n      loadingMessage.value = '地图API加载失败，请刷新重试'\r\n    }\r\n    \r\n    document.head.appendChild(script)\r\n  })\r\n}\r\n\r\n// 初始化地图\r\nasync function initMap() {\r\n  try {\r\n    // 检查容器是否存在\r\n    if (!mapContainer.value) {\r\n      console.error('地图容器不存在')\r\n      loadingMessage.value = '地图容器不存在，请刷新页面'\r\n      return\r\n    }\r\n    \r\n    // 如果地图实例已存在，先销毁\r\n    if (mapInstance) {\r\n      console.log('销毁现有地图实例')\r\n      mapInstance.destroy()\r\n      mapInstance = null\r\n      currentHeatmap = null\r\n    }\r\n    \r\n    // 确保高德地图API已加载\r\n    if (!window.AMap) {\r\n      loadingMessage.value = '正在加载高德地图API...'\r\n      await loadAMapScript()\r\n    }\r\n    \r\n    loadingMessage.value = '正在初始化地图...'\r\n    console.log(`正在初始化地图，容器ID: ${mapContainerId}`)\r\n    \r\n    // 等待下一个tick确保DOM完全渲染\r\n    await nextTick()\r\n    \r\n    // 再次检查容器\r\n    const containerElement = document.getElementById(mapContainerId)\r\n    if (!containerElement) {\r\n      console.error(`找不到地图容器: ${mapContainerId}`)\r\n      loadingMessage.value = '地图容器初始化失败'\r\n      return\r\n    }\r\n    \r\n    // 创建地图实例\r\n    mapInstance = new window.AMap.Map(mapContainerId, {\r\n      center: [117.120, 36.651], // 济南市中心\r\n      zoom: 8,                   // 缩放级别\r\n      viewMode: '2D',            // 2D模式\r\n      mapStyle: mapStyleOptions[currentMapStyle.value],\r\n      // 添加配置项解决Canvas警告\r\n      features: ['bg', 'road', 'building', 'point'],\r\n      // 禁用某些可能导致Canvas问题的功能\r\n      doubleClickZoom: false,\r\n      // 设置地图渲染模式\r\n      renderMode: 'canvas'\r\n    })\r\n    \r\n    // 添加地图控件\r\n    mapInstance.plugin(['AMap.ToolBar', 'AMap.Scale'], function() {\r\n      mapInstance.addControl(new window.AMap.ToolBar())\r\n      mapInstance.addControl(new window.AMap.Scale())\r\n    })\r\n    \r\n    // 监听地图加载完成事件\r\n    mapInstance.on('complete', function() {\r\n      console.log('地图加载完成')\r\n      mapLoaded.value = true\r\n      // 根据当前视图类型更新地图\r\n      updateMapByViewType(currentMapView.value)\r\n    })\r\n    \r\n    // 监听地图错误事件\r\n    mapInstance.on('error', function(error) {\r\n      console.error('地图加载错误:', error)\r\n      loadingMessage.value = '地图加载错误，请刷新重试'\r\n    })\r\n    \r\n  } catch (error) {\r\n    console.error('地图初始化失败:', error)\r\n    loadingMessage.value = '地图初始化失败，请刷新重试'\r\n  }\r\n}\r\n\r\n// 根据视图类型更新地图\r\nfunction updateMapByViewType(viewType) {\r\n  if (!mapInstance) return\r\n  \r\n  // 根据视图类型设置默认风格\r\n  if (viewStyleMap[viewType]) {\r\n    currentMapStyle.value = viewStyleMap[viewType]\r\n    mapInstance.setMapStyle(mapStyleOptions[currentMapStyle.value])\r\n  }\r\n  \r\n  // 根据不同视图类型执行不同操作\r\n  switch (viewType) {\r\n    case 'distribution':\r\n      // 分布视图逻辑\r\n      renderDistributionView()\r\n      break\r\n    case 'trajectory':\r\n      // 轨迹视图逻辑\r\n      renderTrajectoryView()\r\n      break\r\n    case 'heatmap':\r\n      // 热力图视图逻辑\r\n      renderHeatmapView()\r\n      break\r\n  }\r\n}\r\n\r\n// 切换地图风格\r\nfunction changeMapStyle(styleKey) {\r\n  if (!mapInstance) return\r\n  \r\n  currentMapStyle.value = styleKey\r\n  mapInstance.setMapStyle(mapStyleOptions[styleKey])\r\n  emit('update:mapStyle', styleKey)\r\n}\r\n\r\n// 分布视图渲染\r\nfunction renderDistributionView() {\r\n  if (!mapInstance || !props.data || !props.data.length) return\r\n  \r\n  // 清除已有标记\r\n  mapInstance.clearMap()\r\n  \r\n  // 添加点标记\r\n  props.data.forEach(item => {\r\n    const lat = item.lat || item.latitude\r\n    const lng = item.lng || item.longitude\r\n    \r\n    if (lat && lng) {\r\n      new window.AMap.Marker({\r\n        position: [lng, lat],\r\n        map: mapInstance,\r\n        icon: new window.AMap.Icon({\r\n          size: new window.AMap.Size(6, 6),\r\n          image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSI2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxjaXJjbGUgY3g9IjMiIGN5PSIzIiByPSIzIiBmaWxsPSIjMDBjZmZmIi8+PC9zdmc+',\r\n          imageSize: new window.AMap.Size(6, 6)\r\n        })\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n// 轨迹视图渲染\r\nfunction renderTrajectoryView() {\r\n  if (!mapInstance || !props.data || !props.data.length) return\r\n  \r\n  // 清除已有标记\r\n  mapInstance.clearMap()\r\n  \r\n  // 如果有指定车辆ID，绘制该车辆轨迹\r\n  if (props.vehicleId) {\r\n    const vehicleData = props.data\r\n      .filter(item => item.vehicleId === props.vehicleId || item.vehicle_id === props.vehicleId)\r\n      .sort((a, b) => {\r\n        const timeA = a.timestamp || a.UTC || 0\r\n        const timeB = b.timestamp || b.UTC || 0\r\n        return timeA - timeB\r\n      })\r\n    \r\n    if (vehicleData.length > 1) {\r\n      // 创建轨迹路径\r\n      const path = vehicleData.map(item => {\r\n        const lng = item.lng || item.longitude\r\n        const lat = item.lat || item.latitude\r\n        return [lng, lat]\r\n      })\r\n      \r\n      // 绘制轨迹线\r\n      const polyline = new window.AMap.Polyline({\r\n        path: path,\r\n        strokeColor: '#00cfff',\r\n        strokeWeight: 4,\r\n        strokeOpacity: 0.8,\r\n        showDir: true\r\n      })\r\n      \r\n      mapInstance.add(polyline)\r\n      \r\n      // 添加起点和终点标记\r\n      const startMarker = new window.AMap.Marker({\r\n        position: path[0],\r\n        map: mapInstance,\r\n        icon: new window.AMap.Icon({\r\n          size: new window.AMap.Size(25, 34),\r\n          imageSize: new window.AMap.Size(25, 34),\r\n          image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png'\r\n        })\r\n      })\r\n      \r\n      const endMarker = new window.AMap.Marker({\r\n        position: path[path.length - 1],\r\n        map: mapInstance,\r\n        icon: new window.AMap.Icon({\r\n          size: new window.AMap.Size(25, 34),\r\n          imageSize: new window.AMap.Size(25, 34),\r\n          image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-spot.png'\r\n        })\r\n      })\r\n      \r\n      // 自适应缩放级别\r\n      mapInstance.setFitView([polyline, startMarker, endMarker])\r\n    }\r\n  }\r\n}\r\n\r\n// 热力图视图渲染\r\nfunction renderHeatmapView() {\r\n  if (!mapInstance || !props.data || !props.data.length) return\r\n  \r\n  // 清除已有标记和热力图\r\n  mapInstance.clearMap()\r\n  if (currentHeatmap) {\r\n    currentHeatmap.setMap(null)\r\n    currentHeatmap = null\r\n  }\r\n  \r\n  // 准备热力图数据\r\n  const heatmapData = props.data.map(item => {\r\n    const lng = item.lng || item.longitude\r\n    const lat = item.lat || item.latitude\r\n    const count = item.count || item.speed || 1\r\n    \r\n    return {\r\n      lng: lng,\r\n      lat: lat,\r\n      count: count\r\n    }\r\n  }).filter(item => item.lng && item.lat) // 过滤掉无效数据\r\n  \r\n  if (heatmapData.length === 0) {\r\n    console.warn('没有有效的热力图数据')\r\n    return\r\n  }\r\n  \r\n  // 加载热力图插件\r\n  mapInstance.plugin(['AMap.HeatMap'], function() {\r\n    try {\r\n      // 创建热力图实例\r\n      currentHeatmap = new window.AMap.HeatMap(mapInstance, {\r\n        radius: 25,\r\n        opacity: [0, 0.8],\r\n        gradient: {\r\n          0.5: 'blue',\r\n          0.65: 'rgb(117,211,248)',\r\n          0.7: 'rgb(0,255,0)',\r\n          0.9: 'yellow',\r\n          1.0: 'red'\r\n        },\r\n        // 添加配置减少Canvas警告\r\n        blur: 0.85,\r\n        zooms: [3, 18]\r\n      })\r\n      \r\n      // 设置热力图数据\r\n      currentHeatmap.setDataSet({\r\n        data: heatmapData,\r\n        max: Math.max(...heatmapData.map(item => item.count))\r\n      })\r\n      \r\n      console.log(`热力图渲染完成，共 ${heatmapData.length} 个点`)\r\n    } catch (error) {\r\n      console.error('热力图渲染失败:', error)\r\n    }\r\n  })\r\n}\r\n\r\n// 切换地图视图\r\nfunction changeMapView(viewType) {\r\n  currentMapView.value = viewType\r\n  emit('update:viewType', viewType)\r\n  updateMapByViewType(viewType)\r\n}\r\n\r\n// 定位到山东省\r\nfunction centerToShandong() {\r\n  if (mapInstance) {\r\n    mapInstance.setZoomAndCenter(7, [118.000, 36.400])\r\n  }\r\n}\r\n\r\n// 定位到济南市\r\nfunction centerToJinan() {\r\n  if (mapInstance) {\r\n    mapInstance.setZoomAndCenter(11, [117.120, 36.651])\r\n  }\r\n}\r\n\r\n// 监听视图类型变化\r\nwatch(() => props.viewType, (newView) => {\r\n  if (mapInstance && newView) {\r\n    currentMapView.value = newView\r\n    updateMapByViewType(newView)\r\n  }\r\n})\r\n\r\n// 监听地图风格变化\r\nwatch(() => props.mapStyle, (newStyle) => {\r\n  if (mapInstance && newStyle) {\r\n    currentMapStyle.value = newStyle\r\n    mapInstance.setMapStyle(mapStyleOptions[newStyle])\r\n  }\r\n})\r\n\r\n// 监听交通数据变化\r\nwatch(() => props.data, (newData) => {\r\n  if (mapInstance && newData && newData.length > 0) {\r\n    updateMapByViewType(currentMapView.value)\r\n  }\r\n}, { deep: true })\r\n\r\n// 组件挂载时初始化地图\r\nonMounted(async () => {\r\n  console.log('TrafficMapPanel 组件已挂载')\r\n  \r\n  // 等待DOM完全渲染\r\n  await nextTick()\r\n  \r\n  // 再等待一个短暂的时间确保所有样式都应用完成\r\n  setTimeout(async () => {\r\n    console.log('开始初始化地图')\r\n    await initMap()\r\n  }, 100) // 减少等待时间，但确保DOM已经渲染\r\n})\r\n\r\n// 组件卸载时销毁地图\r\nonUnmounted(() => {\r\n  console.log('TrafficMapPanel 组件已卸载')\r\n  \r\n  // 清理热力图实例\r\n  if (currentHeatmap) {\r\n    try {\r\n      currentHeatmap.setMap(null)\r\n    } catch (error) {\r\n      console.warn('清理热力图失败:', error)\r\n    }\r\n    currentHeatmap = null\r\n  }\r\n  \r\n  // 清理地图实例\r\n  if (mapInstance) {\r\n    try {\r\n      mapInstance.clearMap()\r\n      mapInstance.destroy()\r\n    } catch (error) {\r\n      console.warn('销毁地图实例失败:', error)\r\n    }\r\n    mapInstance = null\r\n  }\r\n  \r\n  // 重置状态\r\n  mapLoaded.value = false\r\n})\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}