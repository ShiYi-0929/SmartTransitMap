{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { ref, onMounted, computed } from \"vue\";\nimport { Upload, Search, Eye, BarChart3, FileText, TrendingUp, AlertTriangle, Loader2, X, ImageIcon, Camera, Clock, Download, Share2, FileImage, RotateCcw, PieChart, Video, Play, ChevronLeft, ChevronRight } from \"lucide-vue-next\";\nimport { detectionAPI } from \"../api/detection\";\nimport { ElCollapseTransition } from 'element-plus';\nexport default {\n  name: \"RoadDamageDetection\",\n  components: {\n    Upload,\n    Search,\n    Eye,\n    BarChart3,\n    FileText,\n    TrendingUp,\n    AlertTriangle,\n    Loader2,\n    X,\n    ImageIcon,\n    Camera,\n    Clock,\n    Download,\n    Share2,\n    FileImage,\n    RotateCcw,\n    PieChart,\n    Video,\n    Play,\n    ChevronLeft,\n    ChevronRight,\n    ElCollapseTransition\n  },\n  setup() {\n    // 响应式数据\n    const activeTab = ref(\"detection\");\n    const selectedFile = ref(null);\n    const previewUrl = ref(\"\");\n    const isDragging = ref(false);\n    const isDetecting = ref(false);\n    const detectionProgress = ref(0);\n    const detectionTime = ref(0);\n    const detectionResult = ref(null);\n    const selectedDamage = ref(null);\n    const damageFilter = ref(\"all\");\n    const alarms = ref([]);\n    const stats = ref({\n      todayDetections: 0,\n      totalDamages: 0,\n      todayGrowth: 0,\n      severeDamages: 0,\n      moderateDamages: 0,\n      damageTypes: []\n    });\n    const logs = ref([]);\n    const fileInput = ref(null);\n    const currentTime = ref(\"\");\n    const isRefreshingLogs = ref(false);\n    const currentFrameIndex = ref(0);\n\n    // 历史记录相关\n    const searchQuery = ref(\"\");\n    const filterType = ref(\"all\");\n    const historyRecords = ref([]);\n    const expandedHistoryId = ref(null);\n    const historyDetailMap = ref({});\n\n    // API 基础URL\n    const API_BASE = \"/api\";\n\n    // 计算属性\n    const averageConfidence = computed(() => {\n      if (!detectionResult.value?.damages?.length) return 0;\n      const total = detectionResult.value.damages.reduce((sum, d) => sum + d.confidence, 0);\n      return Math.round(total / detectionResult.value.damages.length * 100);\n    });\n    const severeDamageCount = computed(() => {\n      if (!detectionResult.value?.damages?.length) return 0;\n      return detectionResult.value.damages.filter(d => d.severity === \"high\").length;\n    });\n    const recommendedActions = computed(() => {\n      if (!detectionResult.value?.damages?.length) return 0;\n      return detectionResult.value.damages.filter(d => d.severity === \"high\" || d.severity === \"medium\").length;\n    });\n    const filteredDamages = computed(() => {\n      if (!detectionResult.value?.damages?.length) return [];\n      if (damageFilter.value === \"all\") return detectionResult.value.damages;\n      return detectionResult.value.damages.filter(d => d.type === damageFilter.value);\n    });\n    const currentFrame = computed(() => {\n      if (!detectionResult.value?.isVideo) return null;\n      return detectionResult.value.frames[currentFrameIndex.value];\n    });\n    const frameDamages = computed(() => {\n      const frame = currentFrame.value;\n      return frame ? frame.damages : [];\n    });\n    const filteredHistory = computed(() => {\n      let filtered = historyRecords.value;\n      if (filterType.value !== \"all\") {\n        filtered = filtered.filter(record => record.type === filterType.value);\n      }\n      if (searchQuery.value) {\n        const query = searchQuery.value.toLowerCase();\n        filtered = filtered.filter(record => record.filename.toLowerCase().includes(query));\n      }\n      return filtered;\n    });\n\n    // 时间更新\n    const updateTime = () => {\n      currentTime.value = new Date().toLocaleString(\"zh-CN\", {\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        second: \"2-digit\"\n      });\n    };\n\n    // 文件处理\n    const handleFileSelect = event => {\n      const file = event.target.files[0];\n      if (file) {\n        selectedFile.value = file;\n        previewUrl.value = URL.createObjectURL(file);\n        detectionResult.value = null;\n      }\n    };\n    const handleDrop = event => {\n      event.preventDefault();\n      isDragging.value = false;\n      const file = event.dataTransfer.files[0];\n      if (file && (file.type.startsWith(\"image/\") || file.type.startsWith(\"video/\"))) {\n        selectedFile.value = file;\n        previewUrl.value = URL.createObjectURL(file);\n        detectionResult.value = null;\n      }\n    };\n    const clearFile = () => {\n      selectedFile.value = null;\n      previewUrl.value = \"\";\n      detectionResult.value = null;\n      selectedDamage.value = null;\n      if (fileInput.value) {\n        fileInput.value.value = \"\";\n      }\n      alarms.value = []; // 新增：清空告警\n    };\n    const formatFileSize = bytes => {\n      if (bytes === 0) return \"0 Bytes\";\n      const k = 1024;\n      const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\n      const i = Math.floor(Math.log(bytes) / Math.log(k));\n      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n    };\n    const formatDate = timestamp => {\n      return new Date(timestamp).toLocaleString(\"zh-CN\", {\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\"\n      });\n    };\n\n    // 上传文件\n    /* eslint-disable no-unused-vars */\n    const uploadImage = async file => {\n      // const formData = new FormData();\n      // formData.append(\"image\", file);\n\n      try {\n        // const response = await fetch(`${API_BASE}/upload/image`, {\n        //   method: \"POST\",\n        //   body: formData,\n        // });\n        // return await response.json();\n        return await detectionAPI.uploadImage(file);\n      } catch (error) {\n        console.error(\"上传失败:\", error);\n        throw error;\n      }\n    };\n    /* eslint-disable no-unused-vars */\n    // 检测病害\n    const detectDamage = async () => {\n      if (!selectedFile.value) return;\n      isDetecting.value = true;\n      detectionProgress.value = 0;\n      const startTime = Date.now();\n      const progressInterval = setInterval(() => {\n        if (detectionProgress.value < 90) {\n          detectionProgress.value += Math.random() * 15;\n        }\n      }, 200);\n      try {\n        detectionProgress.value = 20;\n        // const uploadResult = await uploadImage(selectedFile.value)\n\n        detectionProgress.value = 40;\n        // 模拟API调用\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        detectionProgress.value = 70;\n        await new Promise(resolve => setTimeout(resolve, 500));\n        detectionProgress.value = 100;\n        if (selectedFile.value.type.startsWith(\"video/\")) {\n          const mockVideoFrames = [{\n            frameIndex: 0,\n            timestamp: 0.5,\n            imageUrl: previewUrl.value,\n            damages: [{\n              id: 1,\n              type: \"裂缝\",\n              bbox: {\n                x: 50,\n                y: 80,\n                width: 120,\n                height: 40\n              },\n              area: 2.5,\n              confidence: 0.92,\n              severity: \"high\"\n            }]\n          }, {\n            frameIndex: 1,\n            timestamp: 2.3,\n            imageUrl: previewUrl.value,\n            damages: [{\n              id: 2,\n              type: \"坑洞\",\n              bbox: {\n                x: 200,\n                y: 150,\n                width: 80,\n                height: 60\n              },\n              area: 1.8,\n              confidence: 0.87,\n              severity: \"medium\"\n            }, {\n              id: 3,\n              type: \"破损\",\n              bbox: {\n                x: 300,\n                y: 100,\n                width: 100,\n                height: 50\n              },\n              area: 3.2,\n              confidence: 0.78,\n              severity: \"low\"\n            }]\n          }, {\n            frameIndex: 2,\n            timestamp: 4.1,\n            imageUrl: previewUrl.value,\n            damages: [{\n              id: 4,\n              type: \"裂缝\",\n              bbox: {\n                x: 100,\n                y: 200,\n                width: 150,\n                height: 30\n              },\n              area: 1.9,\n              confidence: 0.85,\n              severity: \"medium\"\n            }]\n          }];\n          const allDamages = mockVideoFrames.flatMap(frame => frame.damages);\n          detectionResult.value = {\n            isVideo: true,\n            duration: 5.2,\n            totalFrames: mockVideoFrames.length,\n            frames: mockVideoFrames,\n            totalCount: allDamages.length,\n            totalArea: allDamages.reduce((sum, d) => sum + d.area, 0),\n            damages: allDamages\n          };\n          currentFrameIndex.value = 0;\n        } else {\n          const mockDamages = [{\n            id: 1,\n            type: \"裂缝\",\n            bbox: {\n              x: 50,\n              y: 80,\n              width: 120,\n              height: 40\n            },\n            area: 2.5,\n            confidence: 0.92,\n            severity: \"high\"\n          }, {\n            id: 2,\n            type: \"坑洞\",\n            bbox: {\n              x: 200,\n              y: 150,\n              width: 80,\n              height: 60\n            },\n            area: 1.8,\n            confidence: 0.87,\n            severity: \"medium\"\n          }, {\n            id: 3,\n            type: \"破损\",\n            bbox: {\n              x: 300,\n              y: 100,\n              width: 100,\n              height: 50\n            },\n            area: 3.2,\n            confidence: 0.78,\n            severity: \"low\"\n          }];\n          detectionResult.value = {\n            isVideo: false,\n            imageUrl: previewUrl.value,\n            totalCount: mockDamages.length,\n            totalArea: mockDamages.reduce((sum, d) => sum + d.area, 0),\n            damages: mockDamages\n          };\n        }\n        detectionTime.value = ((Date.now() - startTime) / 1000).toFixed(1);\n\n        // 添加到历史记录\n        const newRecord = {\n          id: Date.now(),\n          filename: selectedFile.value.name,\n          type: selectedFile.value.type.startsWith(\"video/\") ? \"video\" : \"image\",\n          timestamp: new Date(),\n          damageCount: detectionResult.value.totalCount,\n          totalArea: detectionResult.value.totalArea.toFixed(1),\n          confidence: averageConfidence.value,\n          severeDamages: severeDamageCount.value,\n          detectionTime: detectionTime.value\n        };\n        historyRecords.value.unshift(newRecord);\n        await fetchStats();\n        await fetchLogs();\n        logs.value.unshift({\n          id: Date.now(),\n          action: \"完成病害检测\",\n          operator: \"系统\",\n          timestamp: new Date(),\n          type: \"detection\",\n          result: `检测到 ${detectionResult.value.totalCount} 处病害`\n        });\n        // 检测完成后获取告警\n        await fetchAlarms();\n      } catch (error) {\n        console.error(\"检测失败:\", error);\n        alert(\"检测失败，请重试\");\n      } finally {\n        clearInterval(progressInterval);\n        isDetecting.value = false;\n        detectionProgress.value = 0;\n      }\n    };\n    const switchToFrame = frameIndex => {\n      currentFrameIndex.value = frameIndex;\n    };\n    const playFrameSequence = () => {\n      if (!detectionResult.value?.isVideo) return;\n      let index = 0;\n      const interval = setInterval(() => {\n        currentFrameIndex.value = index;\n        index++;\n        if (index >= detectionResult.value.frames.length) {\n          clearInterval(interval);\n          currentFrameIndex.value = 0;\n        }\n      }, 1000);\n    };\n    const selectDamage = damage => {\n      selectedDamage.value = damage;\n    };\n    const exportResult = () => {\n      const data = {\n        timestamp: new Date().toISOString(),\n        filename: selectedFile.value?.name,\n        results: detectionResult.value\n      };\n      const blob = new Blob([JSON.stringify(data, null, 2)], {\n        type: \"application/json\"\n      });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `detection_result_${Date.now()}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n    };\n    const shareResult = () => {\n      if (navigator.share) {\n        navigator.share({\n          title: \"路面病害检测结果\",\n          text: `检测到 ${detectionResult.value.totalCount} 处病害，总面积 ${detectionResult.value.totalArea.toFixed(2)}m²`,\n          url: window.location.href\n        });\n      } else {\n        const text = `路面病害检测结果：检测到 ${detectionResult.value.totalCount} 处病害，总面积 ${detectionResult.value.totalArea.toFixed(2)}m²`;\n        navigator.clipboard.writeText(text).then(() => {\n          alert(\"结果已复制到剪贴板\");\n        });\n      }\n    };\n    const dismissAlarm = alarmId => {\n      alarms.value = alarms.value.filter(a => a.id !== alarmId);\n    };\n    const dismissAlarms = () => {\n      alarms.value = [];\n    };\n\n    // 替换fetch相关方法\n    // 获取告警信息\n    const fetchAlarms = async () => {\n      try {\n        // const response = await fetch(`${API_BASE}/alarm`);\n        // const data = await response.json();\n        const data = await detectionAPI.getAlarms();\n        alarms.value = data.alarms || [];\n      } catch (error) {\n        console.error(\"获取告警数据失败:\", error);\n        alarms.value = [{\n          id: 1,\n          message: \"检测到严重路面病害，建议立即处理\",\n          level: \"high\",\n          time: \"2分钟前\"\n        }];\n      }\n    };\n\n    // 获取统计数据\n    const fetchStats = async () => {\n      try {\n        // const response = await fetch(`${API_BASE}/trend`);\n        // const data = await response.json();\n        const data = await detectionAPI.getStatistics();\n        stats.value = {\n          todayDetections: data.todayDetections || 23,\n          totalDamages: data.totalDamages || 45,\n          todayGrowth: data.todayGrowth || 12,\n          severeDamages: data.severeDamages || 8,\n          moderateDamages: data.moderateDamages || 15,\n          damageTypes: data.damageTypes || [{\n            name: \"裂缝\",\n            count: 18,\n            color: \"#ef4444\"\n          }, {\n            name: \"坑洞\",\n            count: 12,\n            color: \"#f97316\"\n          }, {\n            name: \"破损\",\n            count: 10,\n            color: \"#eab308\"\n          }, {\n            name: \"其他\",\n            count: 5,\n            color: \"#6b7280\"\n          }]\n        };\n      } catch (error) {\n        console.error(\"获取统计数据失败:\", error);\n        stats.value = {\n          todayDetections: 23,\n          totalDamages: 45,\n          todayGrowth: 12,\n          severeDamages: 8,\n          moderateDamages: 15,\n          damageTypes: [{\n            name: \"裂缝\",\n            count: 18,\n            color: \"#ef4444\"\n          }, {\n            name: \"坑洞\",\n            count: 12,\n            color: \"#f97316\"\n          }, {\n            name: \"破损\",\n            count: 10,\n            color: \"#eab308\"\n          }, {\n            name: \"其他\",\n            count: 5,\n            color: \"#6b7280\"\n          }]\n        };\n      }\n    };\n\n    // 获取日志\n    const fetchLogs = async () => {\n      try {\n        // const response = await fetch(`${API_BASE}/logs`);\n        // const data = await response.json();\n        const data = await detectionAPI.getLogs();\n        logs.value = data.logs || [];\n      } catch (error) {\n        console.error(\"获取日志失败:\", error);\n        if (logs.value.length === 0) {\n          logs.value = [{\n            id: 1,\n            action: \"系统启动\",\n            operator: \"系统\",\n            timestamp: new Date(Date.now() - 3600000),\n            type: \"system\"\n          }, {\n            id: 2,\n            action: \"用户登录\",\n            operator: \"管理员\",\n            timestamp: new Date(Date.now() - 1800000),\n            type: \"auth\"\n          }, {\n            id: 3,\n            action: \"上传图像文件\",\n            operator: \"用户\",\n            timestamp: new Date(Date.now() - 900000),\n            type: \"upload\"\n          }];\n        }\n      }\n    };\n    const refreshLogs = async () => {\n      isRefreshingLogs.value = true;\n      await fetchLogs();\n      setTimeout(() => {\n        isRefreshingLogs.value = false;\n      }, 1000);\n    };\n    const loadHistory = () => {\n      // 模拟历史数据\n      if (historyRecords.value.length === 0) {\n        historyRecords.value = [{\n          id: 1,\n          filename: \"road_damage_001.jpg\",\n          type: \"image\",\n          timestamp: new Date(Date.now() - 3600000),\n          damageCount: 5,\n          totalArea: 12.5,\n          confidence: 92,\n          severeDamages: 2,\n          detectionTime: 2.3\n        }, {\n          id: 2,\n          filename: \"highway_inspection.mp4\",\n          type: \"video\",\n          timestamp: new Date(Date.now() - 7200000),\n          damageCount: 15,\n          totalArea: 45.8,\n          confidence: 88,\n          severeDamages: 6,\n          detectionTime: 15.7\n        }, {\n          id: 3,\n          filename: \"street_check_002.jpg\",\n          type: \"image\",\n          timestamp: new Date(Date.now() - 86400000),\n          damageCount: 3,\n          totalArea: 8.2,\n          confidence: 95,\n          severeDamages: 1,\n          detectionTime: 1.8\n        }];\n      }\n    };\n    const getDamageStyle = type => {\n      const styles = {\n        裂缝: \"border-red-500 bg-red-500\",\n        坑洞: \"border-orange-500 bg-orange-500\",\n        破损: \"border-yellow-500 bg-yellow-500\",\n        其他: \"border-slate-500 bg-slate-500\"\n      };\n      return styles[type] || \"border-slate-500 bg-slate-500\";\n    };\n    const getDamageBgStyle = type => {\n      const styles = {\n        裂缝: \"bg-red-500\",\n        坑洞: \"bg-orange-500\",\n        破损: \"bg-yellow-500\",\n        其他: \"bg-slate-500\"\n      };\n      return styles[type] || \"bg-slate-500\";\n    };\n    const getSeverityStyle = severity => {\n      const styles = {\n        high: \"bg-red-100 text-red-800\",\n        medium: \"bg-yellow-100 text-yellow-800\",\n        low: \"bg-green-100 text-green-800\"\n      };\n      return styles[severity] || \"bg-slate-100 text-slate-800\";\n    };\n    const getSeverityText = severity => {\n      const texts = {\n        high: \"严重\",\n        medium: \"中等\",\n        low: \"轻微\"\n      };\n      return texts[severity] || severity;\n    };\n    const getLogBorderStyle = type => {\n      const styles = {\n        detection: \"border-blue-400\",\n        upload: \"border-green-400\",\n        system: \"border-purple-400\",\n        auth: \"border-indigo-400\"\n      };\n      return styles[type] || \"border-slate-400\";\n    };\n    const getLogIcon = type => {\n      const icons = {\n        detection: Search,\n        upload: Upload,\n        system: BarChart3,\n        auth: Eye\n      };\n      return icons[type] || FileText;\n    };\n    const getLogIconStyle = type => {\n      const styles = {\n        detection: \"text-blue-500\",\n        upload: \"text-green-500\",\n        system: \"text-purple-500\",\n        auth: \"text-indigo-500\"\n      };\n      return styles[type] || \"text-slate-500\";\n    };\n    const formatTime = timestamp => {\n      const now = new Date();\n      const time = new Date(timestamp);\n      const diff = now - time;\n      if (diff < 60000) return \"刚刚\";\n      if (diff < 3600000) return Math.floor(diff / 60000) + \"分钟前\";\n      if (diff < 86400000) return Math.floor(diff / 3600000) + \"小时前\";\n      return time.toLocaleString(\"zh-CN\", {\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\"\n      });\n    };\n    const toggleHistoryDetail = async record => {\n      if (expandedHistoryId.value === record.id) {\n        expandedHistoryId.value = null;\n        return;\n      }\n      expandedHistoryId.value = record.id;\n      if (!historyDetailMap.value[record.id]) {\n        // 获取详情\n        const res = await detectionAPI.getDetectionResult(record.id);\n        // 适配后端返回结构\n        historyDetailMap.value[record.id] = {\n          totalCount: res.totalCount,\n          typeCount: res.typeCount,\n          // { 裂缝: 2, 坑洞: 1 }\n          avgConfidence: res.avgConfidence,\n          damages: res.damages // [{id, type, confidence, ...}]\n        };\n      }\n    };\n    onMounted(() => {\n      updateTime();\n      setInterval(updateTime, 1000);\n\n      // fetchAlarms(); // 页面初始不再自动获取告警\n      fetchStats();\n      fetchLogs();\n      loadHistory();\n\n      // setInterval(fetchAlarms, 30000); // 不再定时自动获取告警\n    });\n    return {\n      activeTab,\n      selectedFile,\n      previewUrl,\n      isDragging,\n      isDetecting,\n      detectionProgress,\n      detectionTime,\n      detectionResult,\n      selectedDamage,\n      damageFilter,\n      alarms,\n      stats,\n      logs,\n      fileInput,\n      currentTime,\n      isRefreshingLogs,\n      currentFrameIndex,\n      searchQuery,\n      filterType,\n      filteredHistory,\n      averageConfidence,\n      severeDamageCount,\n      recommendedActions,\n      filteredDamages,\n      currentFrame,\n      frameDamages,\n      handleFileSelect,\n      handleDrop,\n      clearFile,\n      formatFileSize,\n      formatDate,\n      detectDamage,\n      switchToFrame,\n      playFrameSequence,\n      selectDamage,\n      exportResult,\n      shareResult,\n      dismissAlarm,\n      dismissAlarms,\n      refreshLogs,\n      getDamageStyle,\n      getDamageBgStyle,\n      getSeverityStyle,\n      getSeverityText,\n      getLogBorderStyle,\n      getLogIcon,\n      getLogIconStyle,\n      formatTime,\n      expandedHistoryId,\n      historyDetailMap,\n      toggleHistoryDetail\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","Upload","Search","Eye","BarChart3","FileText","TrendingUp","AlertTriangle","Loader2","X","ImageIcon","Camera","Clock","Download","Share2","FileImage","RotateCcw","PieChart","Video","Play","ChevronLeft","ChevronRight","detectionAPI","ElCollapseTransition","name","components","setup","activeTab","selectedFile","previewUrl","isDragging","isDetecting","detectionProgress","detectionTime","detectionResult","selectedDamage","damageFilter","alarms","stats","todayDetections","totalDamages","todayGrowth","severeDamages","moderateDamages","damageTypes","logs","fileInput","currentTime","isRefreshingLogs","currentFrameIndex","searchQuery","filterType","historyRecords","expandedHistoryId","historyDetailMap","API_BASE","averageConfidence","value","damages","length","total","reduce","sum","d","confidence","Math","round","severeDamageCount","filter","severity","recommendedActions","filteredDamages","type","currentFrame","isVideo","frames","frameDamages","frame","filteredHistory","filtered","record","query","toLowerCase","filename","includes","updateTime","Date","toLocaleString","year","month","day","hour","minute","second","handleFileSelect","event","file","target","files","URL","createObjectURL","handleDrop","preventDefault","dataTransfer","startsWith","clearFile","formatFileSize","bytes","k","sizes","i","floor","log","parseFloat","pow","toFixed","formatDate","timestamp","uploadImage","error","console","detectDamage","startTime","now","progressInterval","setInterval","random","Promise","resolve","setTimeout","mockVideoFrames","frameIndex","imageUrl","id","bbox","x","y","width","height","area","allDamages","flatMap","duration","totalFrames","totalCount","totalArea","mockDamages","newRecord","damageCount","unshift","fetchStats","fetchLogs","action","operator","result","fetchAlarms","alert","clearInterval","switchToFrame","playFrameSequence","index","interval","selectDamage","damage","exportResult","data","toISOString","results","blob","Blob","JSON","stringify","url","a","document","createElement","href","download","click","revokeObjectURL","shareResult","navigator","share","title","text","window","location","clipboard","writeText","then","dismissAlarm","alarmId","dismissAlarms","getAlarms","message","level","time","getStatistics","count","color","getLogs","refreshLogs","loadHistory","getDamageStyle","styles","裂缝","坑洞","破损","其他","getDamageBgStyle","getSeverityStyle","high","medium","low","getSeverityText","texts","getLogBorderStyle","detection","upload","system","auth","getLogIcon","icons","getLogIconStyle","formatTime","diff","toggleHistoryDetail","res","getDetectionResult","typeCount","avgConfidence"],"sources":["E:\\hhh\\frontend\\src\\components\\RoadDamageDetection.vue"],"sourcesContent":["<template>\r\n  <div class=\"p-6\">\r\n    <div class=\"max-w-7xl mx-auto\">\r\n      <!-- 功能标签页 -->\r\n      <div class=\"mb-6\">\r\n        <div class=\"border-b border-slate-200\">\r\n          <nav class=\"-mb-px flex space-x-8\">\r\n            <button\r\n              @click=\"activeTab = 'detection'\"\r\n              :class=\"[\r\n                'py-2 px-1 border-b-2 font-medium text-sm transition-colors',\r\n                activeTab === 'detection'\r\n                  ? 'border-blue-500 text-blue-600'\r\n                  : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300',\r\n              ]\"\r\n            >\r\n              <Camera class=\"h-4 w-4 mr-2 inline\" />\r\n              实时检测\r\n            </button>\r\n            <button\r\n              @click=\"activeTab = 'history'\"\r\n              :class=\"[\r\n                'py-2 px-1 border-b-2 font-medium text-sm transition-colors',\r\n                activeTab === 'history'\r\n                  ? 'border-blue-500 text-blue-600'\r\n                  : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300',\r\n              ]\"\r\n            >\r\n              <Clock class=\"h-4 w-4 mr-2 inline\" />\r\n              检测历史\r\n            </button>\r\n            <button\r\n              @click=\"activeTab = 'statistics'\"\r\n              :class=\"[\r\n                'py-2 px-1 border-b-2 font-medium text-sm transition-colors',\r\n                activeTab === 'statistics'\r\n                  ? 'border-blue-500 text-blue-600'\r\n                  : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300',\r\n              ]\"\r\n            >\r\n              <BarChart3 class=\"h-4 w-4 mr-2 inline\" />\r\n              统计分析\r\n            </button>\r\n          </nav>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 实时检测标签页 -->\r\n      <div v-show=\"activeTab === 'detection'\">\r\n        <!-- 页面标题 -->\r\n        <div class=\"mb-8\">\r\n          <div class=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 class=\"text-2xl font-bold text-slate-800 flex items-center\">\r\n                <Camera class=\"h-6 w-6 mr-3 text-blue-600\" />\r\n                智能识别路面病害，提供精准检测与分析\r\n              </h1>\r\n              <div class=\"flex items-center mt-2 text-sm text-slate-600\">\r\n                <Clock class=\"h-4 w-4 mr-1\" />\r\n                {{ currentTime }}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 告警面板 -->\r\n        <div v-if=\"alarms.length > 0\" class=\"mb-6\">\r\n          <div class=\"bg-red-50 border border-red-200 rounded-lg p-4 shadow-sm\">\r\n            <div class=\"flex items-center justify-between\">\r\n              <div class=\"flex items-center\">\r\n                <AlertTriangle class=\"h-5 w-5 text-red-500 mr-2\" />\r\n                <h3 class=\"text-red-800 font-medium\">\r\n                  系统告警 ({{ alarms.length }})\r\n                </h3>\r\n              </div>\r\n              <button\r\n                @click=\"dismissAlarms\"\r\n                class=\"text-red-600 hover:text-red-800 text-sm\"\r\n              >\r\n                全部清除\r\n              </button>\r\n            </div>\r\n            <div class=\"mt-3 space-y-2\">\r\n              <div\r\n                v-for=\"alarm in alarms\"\r\n                :key=\"alarm.id\"\r\n                class=\"flex items-center justify-between p-2 bg-white rounded border-l-4 border-red-400\"\r\n              >\r\n                <div class=\"flex-1\">\r\n                  <div class=\"text-red-800 font-medium\">\r\n                    {{ alarm.message }}\r\n                  </div>\r\n                  <div class=\"text-red-600 text-sm\">\r\n                    严重程度: {{ alarm.level }}\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  @click=\"dismissAlarm(alarm.id)\"\r\n                  class=\"text-red-400 hover:text-red-600\"\r\n                >\r\n                  <X class=\"h-4 w-4\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          <!-- 左侧：上传和检测区域 -->\r\n          <div class=\"lg:col-span-2 space-y-6\">\r\n            <!-- 文件上传区域 -->\r\n            <div\r\n              class=\"bg-white rounded-lg shadow-md border border-slate-200 p-6\"\r\n            >\r\n              <h2\r\n                class=\"text-xl font-semibold mb-4 flex items-center text-slate-800\"\r\n              >\r\n                <Upload class=\"h-5 w-5 mr-2 text-blue-600\" />\r\n                图像上传\r\n                <span class=\"ml-auto text-sm text-slate-500\"\r\n                  >支持 JPG, PNG, MP4 (最大50MB)</span\r\n                >\r\n              </h2>\r\n\r\n              <div\r\n                @drop=\"handleDrop\"\r\n                @dragover.prevent\r\n                @dragenter.prevent=\"isDragging = true\"\r\n                @dragleave.prevent=\"isDragging = false\"\r\n                class=\"border-2 border-dashed border-slate-300 rounded-lg p-8 text-center hover:border-blue-400 transition-all duration-200\"\r\n                :class=\"{ 'border-blue-400 bg-blue-50 scale-105': isDragging }\"\r\n              >\r\n                <div v-if=\"!selectedFile\">\r\n                  <ImageIcon class=\"h-12 w-12 text-slate-400 mx-auto mb-4\" />\r\n                  <p class=\"text-slate-600 mb-2\">拖拽图片到此处或点击上传</p>\r\n                  <input\r\n                    type=\"file\"\r\n                    ref=\"fileInput\"\r\n                    @change=\"handleFileSelect\"\r\n                    accept=\"image/*,video/*\"\r\n                    class=\"hidden\"\r\n                  />\r\n                  <button\r\n                    @click=\"$refs.fileInput.click()\"\r\n                    class=\"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors shadow-sm font-medium\"\r\n                  >\r\n                    选择文件\r\n                  </button>\r\n                </div>\r\n\r\n                <div v-else class=\"space-y-4\">\r\n                  <div class=\"relative inline-block\">\r\n                    <!-- 图片预览 -->\r\n                    <img\r\n                      v-if=\"\r\n                        selectedFile.type.startsWith('image/') && previewUrl\r\n                      \"\r\n                      :src=\"previewUrl\"\r\n                      alt=\"预览图片\"\r\n                      class=\"max-h-64 mx-auto rounded-lg shadow-md\"\r\n                    />\r\n                    <!-- 视频预览 -->\r\n                    <video\r\n                      v-else-if=\"\r\n                        selectedFile.type.startsWith('video/') && previewUrl\r\n                      \"\r\n                      :src=\"previewUrl\"\r\n                      controls\r\n                      class=\"max-h-64 mx-auto rounded-lg shadow-md\"\r\n                    >\r\n                      您的浏览器不支持视频播放\r\n                    </video>\r\n                    <div class=\"absolute top-2 right-2\">\r\n                      <button\r\n                        @click=\"clearFile\"\r\n                        class=\"bg-red-500 text-white p-1 rounded-full hover:bg-red-600 shadow-lg\"\r\n                      >\r\n                        <X class=\"h-4 w-4\" />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div class=\"bg-slate-50 rounded-lg p-4\">\r\n                    <div class=\"flex items-center justify-between mb-3\">\r\n                      <div class=\"flex items-center\">\r\n                        <component\r\n                          :is=\"\r\n                            selectedFile.type.startsWith('video/')\r\n                              ? 'Video'\r\n                              : 'FileImage'\r\n                          \"\r\n                          class=\"h-5 w-5 text-slate-500 mr-2\"\r\n                        />\r\n                        <span class=\"text-slate-700 font-medium\">{{\r\n                          selectedFile.name\r\n                        }}</span>\r\n                      </div>\r\n                      <div class=\"text-right\">\r\n                        <span class=\"text-sm text-slate-500\">{{\r\n                          formatFileSize(selectedFile.size)\r\n                        }}</span>\r\n                        <div class=\"text-xs text-slate-400\">\r\n                          {{\r\n                            selectedFile.type.startsWith(\"video/\")\r\n                              ? \"视频文件\"\r\n                              : \"图片文件\"\r\n                          }}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <button\r\n                      @click=\"detectDamage\"\r\n                      :disabled=\"isDetecting\"\r\n                      class=\"w-full bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-sm font-medium\"\r\n                    >\r\n                      <div\r\n                        v-if=\"isDetecting\"\r\n                        class=\"flex items-center justify-center\"\r\n                      >\r\n                        <Loader2 class=\"h-5 w-5 mr-2 animate-spin\" />\r\n                        检测中... ({{ detectionProgress }}%)\r\n                      </div>\r\n                      <div v-else class=\"flex items-center justify-center\">\r\n                        <Search class=\"h-5 w-5 mr-2\" />\r\n                        开始检测\r\n                      </div>\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- 检测结果展示 -->\r\n            <div\r\n              v-if=\"detectionResult\"\r\n              class=\"bg-white rounded-lg shadow-md border border-slate-200 p-6\"\r\n            >\r\n              <div class=\"flex items-center justify-between mb-4\">\r\n                <h2\r\n                  class=\"text-xl font-semibold flex items-center text-slate-800\"\r\n                >\r\n                  <Eye class=\"h-5 w-5 mr-2 text-green-600\" />\r\n                  检测结果\r\n                  <span\r\n                    v-if=\"detectionResult.isVideo\"\r\n                    class=\"ml-2 text-sm bg-purple-100 text-purple-800 px-2 py-1 rounded-full\"\r\n                  >\r\n                    视频 ({{ detectionResult.totalFrames }} 帧)\r\n                  </span>\r\n                </h2>\r\n                <div class=\"flex space-x-2\">\r\n                  <button\r\n                    v-if=\"detectionResult.isVideo\"\r\n                    @click=\"playFrameSequence\"\r\n                    class=\"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium\"\r\n                  >\r\n                    <Play class=\"h-4 w-4 mr-1 inline\" />\r\n                    播放序列\r\n                  </button>\r\n                  <button\r\n                    @click=\"exportResult\"\r\n                    class=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium\"\r\n                  >\r\n                    <Download class=\"h-4 w-4 mr-1 inline\" />\r\n                    导出结果\r\n                  </button>\r\n                  <button\r\n                    @click=\"shareResult\"\r\n                    class=\"bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 transition-colors text-sm font-medium\"\r\n                  >\r\n                    <Share2 class=\"h-4 w-4 mr-1 inline\" />\r\n                    分享\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <!-- 视频时间轴 (仅视频显示) -->\r\n              <div v-if=\"detectionResult.isVideo\" class=\"mb-6\">\r\n                <h3 class=\"font-medium mb-3 flex items-center text-slate-700\">\r\n                  <Clock class=\"h-4 w-4 mr-2\" />\r\n                  视频时间轴 (总时长: {{ detectionResult.duration }}s)\r\n                </h3>\r\n                <div class=\"bg-slate-100 rounded-lg p-4\">\r\n                  <!-- 时间轴进度条 -->\r\n                  <div class=\"relative h-8 bg-slate-200 rounded-full mb-4\">\r\n                    <div\r\n                      v-for=\"(frame, index) in detectionResult.frames\"\r\n                      :key=\"frame.frameIndex\"\r\n                      class=\"absolute top-0 h-8 cursor-pointer transition-all duration-200 hover:scale-110\"\r\n                      :style=\"{\r\n                        left:\r\n                          (frame.timestamp / detectionResult.duration) * 100 +\r\n                          '%',\r\n                        width: '8px',\r\n                        marginLeft: '-4px',\r\n                      }\"\r\n                      @click=\"switchToFrame(index)\"\r\n                    >\r\n                      <div\r\n                        class=\"w-2 h-8 rounded-full shadow-md\"\r\n                        :class=\"[\r\n                          index === currentFrameIndex\r\n                            ? 'bg-blue-600'\r\n                            : frame.damages.length > 0\r\n                            ? 'bg-red-500'\r\n                            : 'bg-green-500',\r\n                        ]\"\r\n                      ></div>\r\n                      <div\r\n                        class=\"absolute top-10 left-1/2 transform -translate-x-1/2 text-xs text-slate-600 whitespace-nowrap\"\r\n                      >\r\n                        {{ frame.timestamp }}s\r\n                      </div>\r\n                    </div>\r\n\r\n                    <!-- 当前播放位置指示器 -->\r\n                    <div\r\n                      class=\"absolute top-0 w-1 h-8 bg-blue-700 rounded-full shadow-lg transition-all duration-300\"\r\n                      :style=\"{\r\n                        left:\r\n                          (currentFrame?.timestamp / detectionResult.duration) *\r\n                            100 +\r\n                          '%',\r\n                        marginLeft: '-2px',\r\n                      }\"\r\n                    ></div>\r\n                  </div>\r\n\r\n                  <!-- 帧信息卡片 -->\r\n                  <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div\r\n                      v-for=\"(frame, index) in detectionResult.frames\"\r\n                      :key=\"frame.frameIndex\"\r\n                      class=\"p-3 rounded-lg border cursor-pointer transition-all duration-200 hover:shadow-md\"\r\n                      :class=\"[\r\n                        index === currentFrameIndex\r\n                          ? 'border-blue-500 bg-blue-50'\r\n                          : 'border-slate-200 bg-white',\r\n                      ]\"\r\n                      @click=\"switchToFrame(index)\"\r\n                    >\r\n                      <div class=\"flex items-center justify-between mb-2\">\r\n                        <span class=\"text-sm font-medium text-slate-700\"\r\n                          >帧 {{ frame.frameIndex + 1 }}</span\r\n                        >\r\n                        <span class=\"text-xs text-slate-500\"\r\n                          >{{ frame.timestamp }}s</span\r\n                        >\r\n                      </div>\r\n                      <div class=\"text-xs text-slate-600\">\r\n                        检测到 {{ frame.damages.length }} 处病害\r\n                      </div>\r\n                      <div class=\"flex space-x-1 mt-2\">\r\n                        <div\r\n                          v-for=\"damage in frame.damages.slice(0, 3)\"\r\n                          :key=\"damage.id\"\r\n                          class=\"w-2 h-2 rounded-full\"\r\n                          :class=\"getDamageBgStyle(damage.type)\"\r\n                        ></div>\r\n                        <span\r\n                          v-if=\"frame.damages.length > 3\"\r\n                          class=\"text-xs text-slate-400\"\r\n                        >\r\n                          +{{ frame.damages.length - 3 }}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <!-- 快速统计卡片 -->\r\n              <div class=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\r\n                <div\r\n                  class=\"bg-blue-50 p-4 rounded-lg text-center border border-blue-100\"\r\n                >\r\n                  <div class=\"text-2xl font-bold text-blue-700\">\r\n                    {{ detectionResult.totalCount }}\r\n                  </div>\r\n                  <div class=\"text-sm text-slate-600\">\r\n                    {{ detectionResult.isVideo ? \"总病害数\" : \"检测到病害\" }}\r\n                  </div>\r\n                </div>\r\n                <div\r\n                  class=\"bg-red-50 p-4 rounded-lg text-center border border-red-100\"\r\n                >\r\n                  <div class=\"text-2xl font-bold text-red-600\">\r\n                    {{ detectionResult.totalArea.toFixed(2) }}\r\n                  </div>\r\n                  <div class=\"text-sm text-slate-600\">总面积(m²)</div>\r\n                </div>\r\n                <div\r\n                  class=\"bg-yellow-50 p-4 rounded-lg text-center border border-yellow-100\"\r\n                >\r\n                  <div class=\"text-2xl font-bold text-yellow-600\">\r\n                    {{ averageConfidence }}%\r\n                  </div>\r\n                  <div class=\"text-sm text-slate-600\">平均置信度</div>\r\n                </div>\r\n                <div\r\n                  class=\"bg-green-50 p-4 rounded-lg text-center border border-green-100\"\r\n                >\r\n                  <div class=\"text-2xl font-bold text-green-600\">\r\n                    {{\r\n                      detectionResult.isVideo\r\n                        ? detectionResult.totalFrames\r\n                        : detectionTime + \"s\"\r\n                    }}\r\n                  </div>\r\n                  <div class=\"text-sm text-slate-600\">\r\n                    {{ detectionResult.isVideo ? \"检测帧数\" : \"检测用时\" }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                <!-- 结果图像/当前帧 -->\r\n                <div>\r\n                  <h3 class=\"font-medium mb-3 text-slate-700\">\r\n                    {{\r\n                      detectionResult.isVideo\r\n                        ? `当前帧 (${currentFrame?.timestamp}s)`\r\n                        : \"标注结果\"\r\n                    }}\r\n                  </h3>\r\n                  <div class=\"relative bg-slate-100 rounded-lg overflow-hidden\">\r\n                    <img\r\n                      :src=\"\r\n                        detectionResult.isVideo\r\n                          ? currentFrame?.imageUrl\r\n                          : detectionResult.imageUrl\r\n                      \"\r\n                      alt=\"检测结果\"\r\n                      class=\"w-full rounded-lg\"\r\n                    />\r\n                    <!-- 病害标注叠加 -->\r\n                    <div\r\n                      v-for=\"damage in detectionResult.isVideo\r\n                        ? frameDamages\r\n                        : detectionResult.damages\"\r\n                      :key=\"damage.id\"\r\n                      class=\"absolute border-2 bg-opacity-20 cursor-pointer hover:bg-opacity-40 transition-all\"\r\n                      :class=\"getDamageStyle(damage.type)\"\r\n                      :style=\"{\r\n                        left: damage.bbox.x + 'px',\r\n                        top: damage.bbox.y + 'px',\r\n                        width: damage.bbox.width + 'px',\r\n                        height: damage.bbox.height + 'px',\r\n                      }\"\r\n                      @click=\"selectDamage(damage)\"\r\n                    >\r\n                      <div\r\n                        class=\"text-white text-xs px-2 py-1 rounded shadow-lg font-medium\"\r\n                        :class=\"getDamageBgStyle(damage.type)\"\r\n                      >\r\n                        {{ damage.type }} ({{\r\n                          (damage.confidence * 100).toFixed(1)\r\n                        }}%)\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <!-- 视频帧导航 -->\r\n                  <div\r\n                    v-if=\"detectionResult.isVideo\"\r\n                    class=\"flex justify-center mt-4 space-x-2\"\r\n                  >\r\n                    <button\r\n                      @click=\"switchToFrame(Math.max(0, currentFrameIndex - 1))\"\r\n                      :disabled=\"currentFrameIndex === 0\"\r\n                      class=\"px-3 py-1 bg-slate-200 rounded hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                      <ChevronLeft class=\"h-4 w-4\" />\r\n                    </button>\r\n                    <span\r\n                      class=\"px-4 py-1 bg-blue-100 text-blue-800 rounded font-medium\"\r\n                    >\r\n                      {{ currentFrameIndex + 1 }} /\r\n                      {{ detectionResult.totalFrames }}\r\n                    </span>\r\n                    <button\r\n                      @click=\"\r\n                        switchToFrame(\r\n                          Math.min(\r\n                            detectionResult.totalFrames - 1,\r\n                            currentFrameIndex + 1\r\n                          )\r\n                        )\r\n                      \"\r\n                      :disabled=\"\r\n                        currentFrameIndex === detectionResult.totalFrames - 1\r\n                      \"\r\n                      class=\"px-3 py-1 bg-slate-200 rounded hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                      <ChevronRight class=\"h-4 w-4\" />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- 检测详情 -->\r\n                <div class=\"space-y-4\">\r\n                  <div class=\"bg-slate-50 rounded-lg p-4\">\r\n                    <h3 class=\"font-medium mb-3 text-slate-700\">\r\n                      {{ detectionResult.isVideo ? \"整体摘要\" : \"检测摘要\" }}\r\n                    </h3>\r\n                    <div class=\"grid grid-cols-2 gap-4 text-sm\">\r\n                      <div class=\"flex justify-between\">\r\n                        <span class=\"text-slate-600\">\r\n                          {{\r\n                            detectionResult.isVideo ? \"总病害:\" : \"病害数量:\"\r\n                          }}\r\n                        </span>\r\n                        <span class=\"font-medium text-slate-800\">{{\r\n                          detectionResult.totalCount\r\n                        }}</span>\r\n                      </div>\r\n                      <div class=\"flex justify-between\">\r\n                        <span class=\"text-slate-600\">总面积:</span>\r\n                        <span class=\"font-medium text-slate-800\"\r\n                          >{{ detectionResult.totalArea.toFixed(2) }}m²</span\r\n                        >\r\n                      </div>\r\n                      <div class=\"flex justify-between\">\r\n                        <span class=\"text-slate-600\">严重病害:</span>\r\n                        <span class=\"font-medium text-red-600\">{{\r\n                          severeDamageCount\r\n                        }}</span>\r\n                      </div>\r\n                      <div class=\"flex justify-between\">\r\n                        <span class=\"text-slate-600\">\r\n                          {{\r\n                            detectionResult.isVideo ? \"问题帧数:\" : \"建议处理:\"\r\n                          }}\r\n                        </span>\r\n                        <span class=\"font-medium text-yellow-600\">\r\n                          {{\r\n                            detectionResult.isVideo\r\n                              ? detectionResult.frames.filter(\r\n                                  (f) => f.damages.length > 0\r\n                                ).length\r\n                              : recommendedActions\r\n                          }}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div class=\"space-y-2\">\r\n                    <div class=\"flex items-center justify-between\">\r\n                      <h3 class=\"font-medium text-slate-700\">\r\n                        {{\r\n                          detectionResult.isVideo ? \"当前帧病害\" : \"病害详情\"\r\n                        }}\r\n                      </h3>\r\n                      <select\r\n                        v-model=\"damageFilter\"\r\n                        class=\"text-sm border border-slate-300 rounded px-2 py-1 bg-white\"\r\n                      >\r\n                        <option value=\"all\">全部类型</option>\r\n                        <option value=\"裂缝\">裂缝</option>\r\n                        <option value=\"坑洞\">坑洞</option>\r\n                        <option value=\"破损\">破损</option>\r\n                        <option value=\"其他\">其他</option>\r\n                      </select>\r\n                    </div>\r\n\r\n                    <div\r\n                      class=\"max-h-64 overflow-y-auto space-y-2 custom-scrollbar\"\r\n                    >\r\n                      <div\r\n                        v-for=\"damage in detectionResult.isVideo\r\n                          ? frameDamages.filter(\r\n                              (d) =>\r\n                                damageFilter === 'all' ||\r\n                                d.type === damageFilter\r\n                            )\r\n                          : filteredDamages\"\r\n                        :key=\"damage.id\"\r\n                        class=\"flex items-center justify-between p-3 rounded-lg border cursor-pointer hover:bg-slate-50 transition-colors\"\r\n                        :class=\"{\r\n                          'bg-blue-50 border-blue-200':\r\n                            selectedDamage?.id === damage.id,\r\n                        }\"\r\n                        @click=\"selectDamage(damage)\"\r\n                      >\r\n                        <div class=\"flex items-center\">\r\n                          <div\r\n                            class=\"w-3 h-3 rounded-full mr-3\"\r\n                            :class=\"getDamageBgStyle(damage.type)\"\r\n                          ></div>\r\n                          <div>\r\n                            <div class=\"font-medium text-slate-800\">\r\n                              {{ damage.type }}\r\n                            </div>\r\n                            <div class=\"text-slate-600 text-sm\">\r\n                              置信度:\r\n                              {{ (damage.confidence * 100).toFixed(1) }}%\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                        <div class=\"text-right\">\r\n                          <div class=\"font-medium text-slate-800\">\r\n                            {{ damage.area.toFixed(2) }}m²\r\n                          </div>\r\n                          <div\r\n                            class=\"text-sm px-2 py-1 rounded-full\"\r\n                            :class=\"getSeverityStyle(damage.severity)\"\r\n                          >\r\n                            {{ getSeverityText(damage.severity) }}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- 右侧：实时统计 -->\r\n          <div class=\"space-y-6\">\r\n            <!-- 实时统计 -->\r\n            <div\r\n              class=\"bg-white rounded-lg shadow-md border border-slate-200 p-6\"\r\n            >\r\n              <h2\r\n                class=\"text-xl font-semibold mb-4 flex items-center text-slate-800\"\r\n              >\r\n                <BarChart3 class=\"h-5 w-5 mr-2 text-purple-600\" />\r\n                实时统计\r\n              </h2>\r\n\r\n              <div class=\"space-y-4\">\r\n                <div class=\"grid grid-cols-1 gap-4\">\r\n                  <div\r\n                    class=\"text-center p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border border-blue-200\"\r\n                  >\r\n                    <div class=\"text-3xl font-bold text-blue-700\">\r\n                      {{ stats.todayDetections }}\r\n                    </div>\r\n                    <div class=\"text-sm text-slate-600\">今日检测</div>\r\n                    <div class=\"text-xs text-slate-500 mt-1\">\r\n                      比昨日 {{ stats.todayGrowth > 0 ? \"+\" : \"\"\r\n                      }}{{ stats.todayGrowth }}%\r\n                    </div>\r\n                  </div>\r\n                  <div\r\n                    class=\"text-center p-4 bg-gradient-to-r from-red-50 to-red-100 rounded-lg border border-red-200\"\r\n                  >\r\n                    <div class=\"text-3xl font-bold text-red-600\">\r\n                      {{ stats.totalDamages }}\r\n                    </div>\r\n                    <div class=\"text-sm text-slate-600\">发现病害</div>\r\n                    <div class=\"text-xs text-slate-500 mt-1\">\r\n                      严重: {{ stats.severeDamages }} | 中等:\r\n                      {{ stats.moderateDamages }}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- 病害类型分布 -->\r\n                <div>\r\n                  <h3 class=\"font-medium mb-3 text-slate-700\">病害类型分布</h3>\r\n                  <div class=\"space-y-3\">\r\n                    <div\r\n                      v-for=\"type in stats.damageTypes\"\r\n                      :key=\"type.name\"\r\n                      class=\"space-y-1\"\r\n                    >\r\n                      <div class=\"flex items-center justify-between text-sm\">\r\n                        <span class=\"flex items-center\">\r\n                          <div\r\n                            class=\"w-3 h-3 rounded-full mr-2\"\r\n                            :style=\"{ backgroundColor: type.color }\"\r\n                          ></div>\r\n                          <span class=\"text-slate-700\">{{ type.name }}</span>\r\n                        </span>\r\n                        <span class=\"font-medium text-slate-800\">{{\r\n                          type.count\r\n                        }}</span>\r\n                      </div>\r\n                      <div class=\"w-full bg-slate-200 rounded-full h-2\">\r\n                        <div\r\n                          class=\"h-2 rounded-full transition-all duration-500\"\r\n                          :style=\"{\r\n                            width:\r\n                              (type.count / stats.totalDamages) * 100 + '%',\r\n                            backgroundColor: type.color,\r\n                          }\"\r\n                        ></div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- 操作日志 -->\r\n            <div\r\n              class=\"bg-white rounded-lg shadow-md border border-slate-200 p-6\"\r\n            >\r\n              <div class=\"flex items-center justify-between mb-4\">\r\n                <h2\r\n                  class=\"text-xl font-semibold flex items-center text-slate-800\"\r\n                >\r\n                  <FileText class=\"h-5 w-5 mr-2 text-green-600\" />\r\n                  操作日志\r\n                </h2>\r\n                <button\r\n                  @click=\"refreshLogs\"\r\n                  class=\"text-slate-500 hover:text-slate-700\"\r\n                  :disabled=\"isRefreshingLogs\"\r\n                >\r\n                  <RotateCcw\r\n                    class=\"h-4 w-4\"\r\n                    :class=\"{ 'animate-spin': isRefreshingLogs }\"\r\n                  />\r\n                </button>\r\n              </div>\r\n\r\n              <div class=\"max-h-80 overflow-y-auto space-y-2 custom-scrollbar\">\r\n                <div\r\n                  v-for=\"log in logs\"\r\n                  :key=\"log.id\"\r\n                  class=\"flex items-start justify-between p-3 hover:bg-slate-50 rounded-lg transition-colors border-l-4\"\r\n                  :class=\"getLogBorderStyle(log.type)\"\r\n                >\r\n                  <div class=\"flex-1\">\r\n                    <div class=\"flex items-center\">\r\n                      <component\r\n                        :is=\"getLogIcon(log.type)\"\r\n                        class=\"h-4 w-4 mr-2\"\r\n                        :class=\"getLogIconStyle(log.type)\"\r\n                      />\r\n                      <div class=\"font-medium text-sm text-slate-800\">\r\n                        {{ log.action }}\r\n                      </div>\r\n                    </div>\r\n                    <div class=\"text-slate-600 text-xs mt-1\">\r\n                      操作人: {{ log.operator }}\r\n                      <span v-if=\"log.result\" class=\"ml-2\"\r\n                        >| {{ log.result }}</span\r\n                      >\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"text-slate-500 text-xs whitespace-nowrap ml-2\">\r\n                    {{ formatTime(log.timestamp) }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 检测历史标签页 -->\r\n      <div v-show=\"activeTab === 'history'\">\r\n        <div class=\"bg-white rounded-lg shadow-md border border-slate-200 p-6\">\r\n          <h2 class=\"text-2xl font-bold mb-6 text-slate-800\">检测历史记录</h2>\r\n\r\n          <!-- 搜索和筛选 -->\r\n          <div class=\"flex flex-col md:flex-row gap-4 mb-6\">\r\n            <div class=\"flex-1\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"搜索文件名或检测结果...\"\r\n                class=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                v-model=\"searchQuery\"\r\n              />\r\n            </div>\r\n            <select\r\n              class=\"px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent md:w-48\"\r\n              v-model=\"filterType\"\r\n            >\r\n              <option value=\"all\">全部类型</option>\r\n              <option value=\"image\">图片检测</option>\r\n              <option value=\"video\">视频检测</option>\r\n            </select>\r\n          </div>\r\n\r\n          <!-- 历史记录列表 -->\r\n          <div class=\"space-y-4\">\r\n            <div\r\n              v-for=\"record in filteredHistory\"\r\n              :key=\"record.id\"\r\n              class=\"border border-slate-200 rounded-lg p-4 hover:bg-slate-50 transition-colors cursor-pointer\"\r\n              @click=\"toggleHistoryDetail(record)\"\r\n            >\r\n              <div class=\"flex items-center justify-between\">\r\n                <div class=\"flex-1\">\r\n                  <div class=\"flex items-center space-x-3\">\r\n                    <div class=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n                      <component :is=\"record.type === 'video' ? 'Video' : 'FileImage'\" class=\"h-6 w-6 text-blue-600\" />\r\n                    </div>\r\n                    <div>\r\n                      <h3 class=\"font-medium text-slate-800\">{{ record.filename }}</h3>\r\n                      <p class=\"text-sm text-slate-600\">检测时间: {{ formatDate(record.timestamp) }}</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class=\"text-right\">\r\n                  <div class=\"text-lg font-bold text-blue-600\">{{ record.damageCount }}</div>\r\n                  <div class=\"text-sm text-slate-600\">检测到病害</div>\r\n                </div>\r\n              </div>\r\n              <!-- 展开详情 -->\r\n              <el-collapse-transition>\r\n                <div v-if=\"expandedHistoryId === record.id && historyDetailMap[record.id]\" class=\"mt-4 bg-slate-50 rounded p-4\">\r\n                  <div class=\"mb-2 font-medium\">病害总数：{{ historyDetailMap[record.id].totalCount }}</div>\r\n                  <div class=\"mb-2\">平均置信度：{{ historyDetailMap[record.id].avgConfidence }}%</div>\r\n                  <div class=\"mb-2\">各类型数量：</div>\r\n                  <ul class=\"mb-2 list-disc list-inside\">\r\n                    <li v-for=\"(count, type) in historyDetailMap[record.id].typeCount\" :key=\"type\">{{ type }}：{{ count }} 个</li>\r\n                  </ul>\r\n                  <div class=\"mb-2\">病害详情：</div>\r\n                  <ul class=\"list-decimal list-inside\">\r\n                    <li v-for=\"d in historyDetailMap[record.id].damages\" :key=\"d.id\">\r\n                      类型：{{ d.type }}，置信度：{{ (d.confidence * 100).toFixed(1) }}%\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              </el-collapse-transition>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- 空状态 -->\r\n          <div v-if=\"filteredHistory.length === 0\" class=\"text-center py-12\">\r\n            <div class=\"text-slate-400 mb-4\">\r\n              <FileText class=\"h-16 w-16 mx-auto\" />\r\n            </div>\r\n            <h3 class=\"text-lg font-medium text-slate-900 mb-2\">\r\n              暂无检测记录\r\n            </h3>\r\n            <p class=\"text-slate-600 mb-4\">开始您的第一次路面病害检测</p>\r\n            <button\r\n              @click=\"activeTab = 'detection'\"\r\n              class=\"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium\"\r\n            >\r\n              立即开始检测\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 统计分析标签页 -->\r\n      <div v-show=\"activeTab === 'statistics'\">\r\n        <div class=\"bg-white rounded-lg shadow-md border border-slate-200 p-6\">\r\n          <h2\r\n            class=\"text-xl font-semibold mb-6 flex items-center text-slate-800\"\r\n          >\r\n            <TrendingUp class=\"h-5 w-5 mr-2 text-indigo-600\" />\r\n            趋势分析\r\n          </h2>\r\n\r\n          <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <!-- 时间趋势图 -->\r\n            <div>\r\n              <h3 class=\"font-medium mb-3 text-slate-700\">\r\n                病害检测趋势 (近7天)\r\n              </h3>\r\n              <div\r\n                class=\"h-64 bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg flex items-center justify-center border-2 border-dashed border-slate-300\"\r\n              >\r\n                <div class=\"text-center\">\r\n                  <TrendingUp class=\"h-12 w-12 text-slate-400 mx-auto mb-2\" />\r\n                  <div class=\"text-slate-500 font-medium\">趋势图表区域</div>\r\n                  <div class=\"text-slate-400 text-sm mt-1\">\r\n                    集成 Chart.js 或 ECharts\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- 类型分布饼图 -->\r\n            <div>\r\n              <h3 class=\"font-medium mb-3 text-slate-700\">病害类型分布</h3>\r\n              <div\r\n                class=\"h-64 bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg flex items-center justify-center border-2 border-dashed border-slate-300\"\r\n              >\r\n                <div class=\"text-center\">\r\n                  <PieChart class=\"h-12 w-12 text-slate-400 mx-auto mb-2\" />\r\n                  <div class=\"text-slate-500 font-medium\">饼图区域</div>\r\n                  <div class=\"text-slate-400 text-sm mt-1\">可视化类型分布</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, computed } from \"vue\";\r\nimport {\r\n  Upload,\r\n  Search,\r\n  Eye,\r\n  BarChart3,\r\n  FileText,\r\n  TrendingUp,\r\n  AlertTriangle,\r\n  Loader2,\r\n  X,\r\n  ImageIcon,\r\n  Camera,\r\n  Clock,\r\n  Download,\r\n  Share2,\r\n  FileImage,\r\n  RotateCcw,\r\n  PieChart,\r\n  Video,\r\n  Play,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n} from \"lucide-vue-next\";\r\nimport { detectionAPI } from \"../api/detection\";\r\nimport { ElCollapseTransition } from 'element-plus'\r\n\r\nexport default {\r\n  name: \"RoadDamageDetection\",\r\n  components: {\r\n    Upload,\r\n    Search,\r\n    Eye,\r\n    BarChart3,\r\n    FileText,\r\n    TrendingUp,\r\n    AlertTriangle,\r\n    Loader2,\r\n    X,\r\n    ImageIcon,\r\n    Camera,\r\n    Clock,\r\n    Download,\r\n    Share2,\r\n    FileImage,\r\n    RotateCcw,\r\n    PieChart,\r\n    Video,\r\n    Play,\r\n    ChevronLeft,\r\n    ChevronRight,\r\n    ElCollapseTransition,\r\n  },\r\n  setup() {\r\n    // 响应式数据\r\n    const activeTab = ref(\"detection\");\r\n    const selectedFile = ref(null);\r\n    const previewUrl = ref(\"\");\r\n    const isDragging = ref(false);\r\n    const isDetecting = ref(false);\r\n    const detectionProgress = ref(0);\r\n    const detectionTime = ref(0);\r\n    const detectionResult = ref(null);\r\n    const selectedDamage = ref(null);\r\n    const damageFilter = ref(\"all\");\r\n    const alarms = ref([]);\r\n    const stats = ref({\r\n      todayDetections: 0,\r\n      totalDamages: 0,\r\n      todayGrowth: 0,\r\n      severeDamages: 0,\r\n      moderateDamages: 0,\r\n      damageTypes: [],\r\n    });\r\n    const logs = ref([]);\r\n    const fileInput = ref(null);\r\n    const currentTime = ref(\"\");\r\n    const isRefreshingLogs = ref(false);\r\n    const currentFrameIndex = ref(0);\r\n\r\n    // 历史记录相关\r\n    const searchQuery = ref(\"\");\r\n    const filterType = ref(\"all\");\r\n    const historyRecords = ref([]);\r\n    const expandedHistoryId = ref(null)\r\n    const historyDetailMap = ref({})\r\n\r\n    // API 基础URL\r\n    const API_BASE = \"/api\";\r\n\r\n    // 计算属性\r\n    const averageConfidence = computed(() => {\r\n      if (!detectionResult.value?.damages?.length) return 0;\r\n      const total = detectionResult.value.damages.reduce(\r\n        (sum, d) => sum + d.confidence,\r\n        0\r\n      );\r\n      return Math.round((total / detectionResult.value.damages.length) * 100);\r\n    });\r\n\r\n    const severeDamageCount = computed(() => {\r\n      if (!detectionResult.value?.damages?.length) return 0;\r\n      return detectionResult.value.damages.filter((d) => d.severity === \"high\")\r\n        .length;\r\n    });\r\n\r\n    const recommendedActions = computed(() => {\r\n      if (!detectionResult.value?.damages?.length) return 0;\r\n      return detectionResult.value.damages.filter(\r\n        (d) => d.severity === \"high\" || d.severity === \"medium\"\r\n      ).length;\r\n    });\r\n\r\n    const filteredDamages = computed(() => {\r\n      if (!detectionResult.value?.damages?.length) return [];\r\n      if (damageFilter.value === \"all\") return detectionResult.value.damages;\r\n      return detectionResult.value.damages.filter(\r\n        (d) => d.type === damageFilter.value\r\n      );\r\n    });\r\n\r\n    const currentFrame = computed(() => {\r\n      if (!detectionResult.value?.isVideo) return null;\r\n      return detectionResult.value.frames[currentFrameIndex.value];\r\n    });\r\n\r\n    const frameDamages = computed(() => {\r\n      const frame = currentFrame.value;\r\n      return frame ? frame.damages : [];\r\n    });\r\n\r\n    const filteredHistory = computed(() => {\r\n      let filtered = historyRecords.value;\r\n\r\n      if (filterType.value !== \"all\") {\r\n        filtered = filtered.filter(\r\n          (record) => record.type === filterType.value\r\n        );\r\n      }\r\n\r\n      if (searchQuery.value) {\r\n        const query = searchQuery.value.toLowerCase();\r\n        filtered = filtered.filter((record) =>\r\n          record.filename.toLowerCase().includes(query)\r\n        );\r\n      }\r\n\r\n      return filtered;\r\n    });\r\n\r\n    // 时间更新\r\n    const updateTime = () => {\r\n      currentTime.value = new Date().toLocaleString(\"zh-CN\", {\r\n        year: \"numeric\",\r\n        month: \"2-digit\",\r\n        day: \"2-digit\",\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n        second: \"2-digit\",\r\n      });\r\n    };\r\n\r\n    // 文件处理\r\n    const handleFileSelect = (event) => {\r\n      const file = event.target.files[0];\r\n      if (file) {\r\n        selectedFile.value = file;\r\n        previewUrl.value = URL.createObjectURL(file);\r\n        detectionResult.value = null;\r\n      }\r\n    };\r\n\r\n    const handleDrop = (event) => {\r\n      event.preventDefault();\r\n      isDragging.value = false;\r\n      const file = event.dataTransfer.files[0];\r\n      if (\r\n        file &&\r\n        (file.type.startsWith(\"image/\") || file.type.startsWith(\"video/\"))\r\n      ) {\r\n        selectedFile.value = file;\r\n        previewUrl.value = URL.createObjectURL(file);\r\n        detectionResult.value = null;\r\n      }\r\n    };\r\n\r\n    const clearFile = () => {\r\n      selectedFile.value = null;\r\n      previewUrl.value = \"\";\r\n      detectionResult.value = null;\r\n      selectedDamage.value = null;\r\n      if (fileInput.value) {\r\n        fileInput.value.value = \"\";\r\n      }\r\n      alarms.value = []; // 新增：清空告警\r\n    };\r\n\r\n    const formatFileSize = (bytes) => {\r\n      if (bytes === 0) return \"0 Bytes\";\r\n      const k = 1024;\r\n      const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\r\n      const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\r\n    };\r\n\r\n    const formatDate = (timestamp) => {\r\n      return new Date(timestamp).toLocaleString(\"zh-CN\", {\r\n        year: \"numeric\",\r\n        month: \"2-digit\",\r\n        day: \"2-digit\",\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n      });\r\n    };\r\n\r\n    // 上传文件\r\n    /* eslint-disable no-unused-vars */\r\n    const uploadImage = async (file) => {\r\n      // const formData = new FormData();\r\n      // formData.append(\"image\", file);\r\n\r\n      try {\r\n        // const response = await fetch(`${API_BASE}/upload/image`, {\r\n        //   method: \"POST\",\r\n        //   body: formData,\r\n        // });\r\n        // return await response.json();\r\n        return await detectionAPI.uploadImage(file);\r\n      } catch (error) {\r\n        console.error(\"上传失败:\", error);\r\n        throw error;\r\n      }\r\n    };\r\n    /* eslint-disable no-unused-vars */\r\n    // 检测病害\r\n    const detectDamage = async () => {\r\n      if (!selectedFile.value) return;\r\n\r\n      isDetecting.value = true;\r\n      detectionProgress.value = 0;\r\n      const startTime = Date.now();\r\n\r\n      const progressInterval = setInterval(() => {\r\n        if (detectionProgress.value < 90) {\r\n          detectionProgress.value += Math.random() * 15;\r\n        }\r\n      }, 200);\r\n\r\n      try {\r\n        detectionProgress.value = 20;\r\n        // const uploadResult = await uploadImage(selectedFile.value)\r\n\r\n        detectionProgress.value = 40;\r\n        // 模拟API调用\r\n        await new Promise((resolve) => setTimeout(resolve, 1000));\r\n\r\n        detectionProgress.value = 70;\r\n        await new Promise((resolve) => setTimeout(resolve, 500));\r\n        detectionProgress.value = 100;\r\n\r\n        if (selectedFile.value.type.startsWith(\"video/\")) {\r\n          const mockVideoFrames = [\r\n            {\r\n              frameIndex: 0,\r\n              timestamp: 0.5,\r\n              imageUrl: previewUrl.value,\r\n              damages: [\r\n                {\r\n                  id: 1,\r\n                  type: \"裂缝\",\r\n                  bbox: { x: 50, y: 80, width: 120, height: 40 },\r\n                  area: 2.5,\r\n                  confidence: 0.92,\r\n                  severity: \"high\",\r\n                },\r\n              ],\r\n            },\r\n            {\r\n              frameIndex: 1,\r\n              timestamp: 2.3,\r\n              imageUrl: previewUrl.value,\r\n              damages: [\r\n                {\r\n                  id: 2,\r\n                  type: \"坑洞\",\r\n                  bbox: { x: 200, y: 150, width: 80, height: 60 },\r\n                  area: 1.8,\r\n                  confidence: 0.87,\r\n                  severity: \"medium\",\r\n                },\r\n                {\r\n                  id: 3,\r\n                  type: \"破损\",\r\n                  bbox: { x: 300, y: 100, width: 100, height: 50 },\r\n                  area: 3.2,\r\n                  confidence: 0.78,\r\n                  severity: \"low\",\r\n                },\r\n              ],\r\n            },\r\n            {\r\n              frameIndex: 2,\r\n              timestamp: 4.1,\r\n              imageUrl: previewUrl.value,\r\n              damages: [\r\n                {\r\n                  id: 4,\r\n                  type: \"裂缝\",\r\n                  bbox: { x: 100, y: 200, width: 150, height: 30 },\r\n                  area: 1.9,\r\n                  confidence: 0.85,\r\n                  severity: \"medium\",\r\n                },\r\n              ],\r\n            },\r\n          ];\r\n\r\n          const allDamages = mockVideoFrames.flatMap((frame) => frame.damages);\r\n\r\n          detectionResult.value = {\r\n            isVideo: true,\r\n            duration: 5.2,\r\n            totalFrames: mockVideoFrames.length,\r\n            frames: mockVideoFrames,\r\n            totalCount: allDamages.length,\r\n            totalArea: allDamages.reduce((sum, d) => sum + d.area, 0),\r\n            damages: allDamages,\r\n          };\r\n\r\n          currentFrameIndex.value = 0;\r\n        } else {\r\n          const mockDamages = [\r\n            {\r\n              id: 1,\r\n              type: \"裂缝\",\r\n              bbox: { x: 50, y: 80, width: 120, height: 40 },\r\n              area: 2.5,\r\n              confidence: 0.92,\r\n              severity: \"high\",\r\n            },\r\n            {\r\n              id: 2,\r\n              type: \"坑洞\",\r\n              bbox: { x: 200, y: 150, width: 80, height: 60 },\r\n              area: 1.8,\r\n              confidence: 0.87,\r\n              severity: \"medium\",\r\n            },\r\n            {\r\n              id: 3,\r\n              type: \"破损\",\r\n              bbox: { x: 300, y: 100, width: 100, height: 50 },\r\n              area: 3.2,\r\n              confidence: 0.78,\r\n              severity: \"low\",\r\n            },\r\n          ];\r\n\r\n          detectionResult.value = {\r\n            isVideo: false,\r\n            imageUrl: previewUrl.value,\r\n            totalCount: mockDamages.length,\r\n            totalArea: mockDamages.reduce((sum, d) => sum + d.area, 0),\r\n            damages: mockDamages,\r\n          };\r\n        }\r\n\r\n        detectionTime.value = ((Date.now() - startTime) / 1000).toFixed(1);\r\n\r\n        // 添加到历史记录\r\n        const newRecord = {\r\n          id: Date.now(),\r\n          filename: selectedFile.value.name,\r\n          type: selectedFile.value.type.startsWith(\"video/\")\r\n            ? \"video\"\r\n            : \"image\",\r\n          timestamp: new Date(),\r\n          damageCount: detectionResult.value.totalCount,\r\n          totalArea: detectionResult.value.totalArea.toFixed(1),\r\n          confidence: averageConfidence.value,\r\n          severeDamages: severeDamageCount.value,\r\n          detectionTime: detectionTime.value,\r\n        };\r\n        historyRecords.value.unshift(newRecord);\r\n\r\n        await fetchStats();\r\n        await fetchLogs();\r\n\r\n        logs.value.unshift({\r\n          id: Date.now(),\r\n          action: \"完成病害检测\",\r\n          operator: \"系统\",\r\n          timestamp: new Date(),\r\n          type: \"detection\",\r\n          result: `检测到 ${detectionResult.value.totalCount} 处病害`,\r\n        });\r\n        // 检测完成后获取告警\r\n        await fetchAlarms();\r\n      } catch (error) {\r\n        console.error(\"检测失败:\", error);\r\n        alert(\"检测失败，请重试\");\r\n      } finally {\r\n        clearInterval(progressInterval);\r\n        isDetecting.value = false;\r\n        detectionProgress.value = 0;\r\n      }\r\n    };\r\n\r\n    const switchToFrame = (frameIndex) => {\r\n      currentFrameIndex.value = frameIndex;\r\n    };\r\n\r\n    const playFrameSequence = () => {\r\n      if (!detectionResult.value?.isVideo) return;\r\n\r\n      let index = 0;\r\n      const interval = setInterval(() => {\r\n        currentFrameIndex.value = index;\r\n        index++;\r\n        if (index >= detectionResult.value.frames.length) {\r\n          clearInterval(interval);\r\n          currentFrameIndex.value = 0;\r\n        }\r\n      }, 1000);\r\n    };\r\n\r\n    const selectDamage = (damage) => {\r\n      selectedDamage.value = damage;\r\n    };\r\n\r\n    const exportResult = () => {\r\n      const data = {\r\n        timestamp: new Date().toISOString(),\r\n        filename: selectedFile.value?.name,\r\n        results: detectionResult.value,\r\n      };\r\n\r\n      const blob = new Blob([JSON.stringify(data, null, 2)], {\r\n        type: \"application/json\",\r\n      });\r\n      const url = URL.createObjectURL(blob);\r\n      const a = document.createElement(\"a\");\r\n      a.href = url;\r\n      a.download = `detection_result_${Date.now()}.json`;\r\n      a.click();\r\n      URL.revokeObjectURL(url);\r\n    };\r\n\r\n    const shareResult = () => {\r\n      if (navigator.share) {\r\n        navigator.share({\r\n          title: \"路面病害检测结果\",\r\n          text: `检测到 ${\r\n            detectionResult.value.totalCount\r\n          } 处病害，总面积 ${detectionResult.value.totalArea.toFixed(2)}m²`,\r\n          url: window.location.href,\r\n        });\r\n      } else {\r\n        const text = `路面病害检测结果：检测到 ${\r\n          detectionResult.value.totalCount\r\n        } 处病害，总面积 ${detectionResult.value.totalArea.toFixed(2)}m²`;\r\n        navigator.clipboard.writeText(text).then(() => {\r\n          alert(\"结果已复制到剪贴板\");\r\n        });\r\n      }\r\n    };\r\n\r\n    const dismissAlarm = (alarmId) => {\r\n      alarms.value = alarms.value.filter((a) => a.id !== alarmId);\r\n    };\r\n\r\n    const dismissAlarms = () => {\r\n      alarms.value = [];\r\n    };\r\n\r\n    // 替换fetch相关方法\r\n    // 获取告警信息\r\n    const fetchAlarms = async () => {\r\n      try {\r\n        // const response = await fetch(`${API_BASE}/alarm`);\r\n        // const data = await response.json();\r\n        const data = await detectionAPI.getAlarms();\r\n        alarms.value = data.alarms || [];\r\n      } catch (error) {\r\n        console.error(\"获取告警数据失败:\", error);\r\n        alarms.value = [\r\n          {\r\n            id: 1,\r\n            message: \"检测到严重路面病害，建议立即处理\",\r\n            level: \"high\",\r\n            time: \"2分钟前\",\r\n          },\r\n        ];\r\n      }\r\n    };\r\n\r\n    // 获取统计数据\r\n    const fetchStats = async () => {\r\n      try {\r\n        // const response = await fetch(`${API_BASE}/trend`);\r\n        // const data = await response.json();\r\n        const data = await detectionAPI.getStatistics();\r\n        stats.value = {\r\n          todayDetections: data.todayDetections || 23,\r\n          totalDamages: data.totalDamages || 45,\r\n          todayGrowth: data.todayGrowth || 12,\r\n          severeDamages: data.severeDamages || 8,\r\n          moderateDamages: data.moderateDamages || 15,\r\n          damageTypes: data.damageTypes || [\r\n            { name: \"裂缝\", count: 18, color: \"#ef4444\" },\r\n            { name: \"坑洞\", count: 12, color: \"#f97316\" },\r\n            { name: \"破损\", count: 10, color: \"#eab308\" },\r\n            { name: \"其他\", count: 5, color: \"#6b7280\" },\r\n          ],\r\n        };\r\n      } catch (error) {\r\n        console.error(\"获取统计数据失败:\", error);\r\n        stats.value = {\r\n          todayDetections: 23,\r\n          totalDamages: 45,\r\n          todayGrowth: 12,\r\n          severeDamages: 8,\r\n          moderateDamages: 15,\r\n          damageTypes: [\r\n            { name: \"裂缝\", count: 18, color: \"#ef4444\" },\r\n            { name: \"坑洞\", count: 12, color: \"#f97316\" },\r\n            { name: \"破损\", count: 10, color: \"#eab308\" },\r\n            { name: \"其他\", count: 5, color: \"#6b7280\" },\r\n          ],\r\n        };\r\n      }\r\n    };\r\n\r\n    // 获取日志\r\n    const fetchLogs = async () => {\r\n      try {\r\n        // const response = await fetch(`${API_BASE}/logs`);\r\n        // const data = await response.json();\r\n        const data = await detectionAPI.getLogs();\r\n        logs.value = data.logs || [];\r\n      } catch (error) {\r\n        console.error(\"获取日志失败:\", error);\r\n        if (logs.value.length === 0) {\r\n          logs.value = [\r\n            {\r\n              id: 1,\r\n              action: \"系统启动\",\r\n              operator: \"系统\",\r\n              timestamp: new Date(Date.now() - 3600000),\r\n              type: \"system\",\r\n            },\r\n            {\r\n              id: 2,\r\n              action: \"用户登录\",\r\n              operator: \"管理员\",\r\n              timestamp: new Date(Date.now() - 1800000),\r\n              type: \"auth\",\r\n            },\r\n            {\r\n              id: 3,\r\n              action: \"上传图像文件\",\r\n              operator: \"用户\",\r\n              timestamp: new Date(Date.now() - 900000),\r\n              type: \"upload\",\r\n            },\r\n          ];\r\n        }\r\n      }\r\n    };\r\n\r\n    const refreshLogs = async () => {\r\n      isRefreshingLogs.value = true;\r\n      await fetchLogs();\r\n      setTimeout(() => {\r\n        isRefreshingLogs.value = false;\r\n      }, 1000);\r\n    };\r\n\r\n    const loadHistory = () => {\r\n      // 模拟历史数据\r\n      if (historyRecords.value.length === 0) {\r\n        historyRecords.value = [\r\n          {\r\n            id: 1,\r\n            filename: \"road_damage_001.jpg\",\r\n            type: \"image\",\r\n            timestamp: new Date(Date.now() - 3600000),\r\n            damageCount: 5,\r\n            totalArea: 12.5,\r\n            confidence: 92,\r\n            severeDamages: 2,\r\n            detectionTime: 2.3,\r\n          },\r\n          {\r\n            id: 2,\r\n            filename: \"highway_inspection.mp4\",\r\n            type: \"video\",\r\n            timestamp: new Date(Date.now() - 7200000),\r\n            damageCount: 15,\r\n            totalArea: 45.8,\r\n            confidence: 88,\r\n            severeDamages: 6,\r\n            detectionTime: 15.7,\r\n          },\r\n          {\r\n            id: 3,\r\n            filename: \"street_check_002.jpg\",\r\n            type: \"image\",\r\n            timestamp: new Date(Date.now() - 86400000),\r\n            damageCount: 3,\r\n            totalArea: 8.2,\r\n            confidence: 95,\r\n            severeDamages: 1,\r\n            detectionTime: 1.8,\r\n          },\r\n        ];\r\n      }\r\n    };\r\n\r\n    const getDamageStyle = (type) => {\r\n      const styles = {\r\n        裂缝: \"border-red-500 bg-red-500\",\r\n        坑洞: \"border-orange-500 bg-orange-500\",\r\n        破损: \"border-yellow-500 bg-yellow-500\",\r\n        其他: \"border-slate-500 bg-slate-500\",\r\n      };\r\n      return styles[type] || \"border-slate-500 bg-slate-500\";\r\n    };\r\n\r\n    const getDamageBgStyle = (type) => {\r\n      const styles = {\r\n        裂缝: \"bg-red-500\",\r\n        坑洞: \"bg-orange-500\",\r\n        破损: \"bg-yellow-500\",\r\n        其他: \"bg-slate-500\",\r\n      };\r\n      return styles[type] || \"bg-slate-500\";\r\n    };\r\n\r\n    const getSeverityStyle = (severity) => {\r\n      const styles = {\r\n        high: \"bg-red-100 text-red-800\",\r\n        medium: \"bg-yellow-100 text-yellow-800\",\r\n        low: \"bg-green-100 text-green-800\",\r\n      };\r\n      return styles[severity] || \"bg-slate-100 text-slate-800\";\r\n    };\r\n\r\n    const getSeverityText = (severity) => {\r\n      const texts = {\r\n        high: \"严重\",\r\n        medium: \"中等\",\r\n        low: \"轻微\",\r\n      };\r\n      return texts[severity] || severity;\r\n    };\r\n\r\n    const getLogBorderStyle = (type) => {\r\n      const styles = {\r\n        detection: \"border-blue-400\",\r\n        upload: \"border-green-400\",\r\n        system: \"border-purple-400\",\r\n        auth: \"border-indigo-400\",\r\n      };\r\n      return styles[type] || \"border-slate-400\";\r\n    };\r\n\r\n    const getLogIcon = (type) => {\r\n      const icons = {\r\n        detection: Search,\r\n        upload: Upload,\r\n        system: BarChart3,\r\n        auth: Eye,\r\n      };\r\n      return icons[type] || FileText;\r\n    };\r\n\r\n    const getLogIconStyle = (type) => {\r\n      const styles = {\r\n        detection: \"text-blue-500\",\r\n        upload: \"text-green-500\",\r\n        system: \"text-purple-500\",\r\n        auth: \"text-indigo-500\",\r\n      };\r\n      return styles[type] || \"text-slate-500\";\r\n    };\r\n\r\n    const formatTime = (timestamp) => {\r\n      const now = new Date();\r\n      const time = new Date(timestamp);\r\n      const diff = now - time;\r\n\r\n      if (diff < 60000) return \"刚刚\";\r\n      if (diff < 3600000) return Math.floor(diff / 60000) + \"分钟前\";\r\n      if (diff < 86400000) return Math.floor(diff / 3600000) + \"小时前\";\r\n\r\n      return time.toLocaleString(\"zh-CN\", {\r\n        month: \"2-digit\",\r\n        day: \"2-digit\",\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n      });\r\n    };\r\n\r\n    const toggleHistoryDetail = async (record) => {\r\n      if (expandedHistoryId.value === record.id) {\r\n        expandedHistoryId.value = null\r\n        return\r\n      }\r\n      expandedHistoryId.value = record.id\r\n      if (!historyDetailMap.value[record.id]) {\r\n        // 获取详情\r\n        const res = await detectionAPI.getDetectionResult(record.id)\r\n        // 适配后端返回结构\r\n        historyDetailMap.value[record.id] = {\r\n          totalCount: res.totalCount,\r\n          typeCount: res.typeCount, // { 裂缝: 2, 坑洞: 1 }\r\n          avgConfidence: res.avgConfidence,\r\n          damages: res.damages // [{id, type, confidence, ...}]\r\n        }\r\n      }\r\n    }\r\n\r\n    onMounted(() => {\r\n      updateTime();\r\n      setInterval(updateTime, 1000);\r\n\r\n      // fetchAlarms(); // 页面初始不再自动获取告警\r\n      fetchStats();\r\n      fetchLogs();\r\n      loadHistory();\r\n\r\n      // setInterval(fetchAlarms, 30000); // 不再定时自动获取告警\r\n    });\r\n\r\n    return {\r\n      activeTab,\r\n      selectedFile,\r\n      previewUrl,\r\n      isDragging,\r\n      isDetecting,\r\n      detectionProgress,\r\n      detectionTime,\r\n      detectionResult,\r\n      selectedDamage,\r\n      damageFilter,\r\n      alarms,\r\n      stats,\r\n      logs,\r\n      fileInput,\r\n      currentTime,\r\n      isRefreshingLogs,\r\n      currentFrameIndex,\r\n      searchQuery,\r\n      filterType,\r\n      filteredHistory,\r\n      averageConfidence,\r\n      severeDamageCount,\r\n      recommendedActions,\r\n      filteredDamages,\r\n      currentFrame,\r\n      frameDamages,\r\n      handleFileSelect,\r\n      handleDrop,\r\n      clearFile,\r\n      formatFileSize,\r\n      formatDate,\r\n      detectDamage,\r\n      switchToFrame,\r\n      playFrameSequence,\r\n      selectDamage,\r\n      exportResult,\r\n      shareResult,\r\n      dismissAlarm,\r\n      dismissAlarms,\r\n      refreshLogs,\r\n      getDamageStyle,\r\n      getDamageBgStyle,\r\n      getSeverityStyle,\r\n      getSeverityText,\r\n      getLogBorderStyle,\r\n      getLogIcon,\r\n      getLogIconStyle,\r\n      formatTime,\r\n      expandedHistoryId,\r\n      historyDetailMap,\r\n      toggleHistoryDetail,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.animate-spin {\r\n  animation: spin 1s linear infinite;\r\n}\r\n\r\n@keyframes spin {\r\n  from {\r\n    transform: rotate(0deg);\r\n  }\r\n  to {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n\r\n.custom-scrollbar::-webkit-scrollbar {\r\n  width: 6px;\r\n}\r\n\r\n.custom-scrollbar::-webkit-scrollbar-track {\r\n  background: #f1f5f9;\r\n  border-radius: 3px;\r\n}\r\n\r\n.custom-scrollbar::-webkit-scrollbar-thumb {\r\n  background: #cbd5e1;\r\n  border-radius: 3px;\r\n}\r\n\r\n.custom-scrollbar::-webkit-scrollbar-thumb:hover {\r\n  background: #94a3b8;\r\n}\r\n\r\n.transition-all {\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .grid-cols-2 {\r\n    grid-template-columns: repeat(1, minmax(0, 1fr));\r\n  }\r\n\r\n  .lg\\:col-span-2 {\r\n    grid-column: span 1;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}