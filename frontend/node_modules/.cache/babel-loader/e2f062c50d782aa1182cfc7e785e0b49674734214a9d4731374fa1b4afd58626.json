{"ast":null,"code":"import { createVNode as _createVNode, createTextVNode as _createTextVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"card-tech p-6\"\n};\nconst _hoisted_2 = {\n  class: \"flex items-center justify-between mb-4\"\n};\nconst _hoisted_3 = {\n  class: \"text-xl font-semibold text-white flex items-center\"\n};\nconst _hoisted_4 = {\n  class: \"flex space-x-2\"\n};\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = {\n  class: \"mb-4 flex flex-wrap gap-2\"\n};\nconst _hoisted_7 = [\"onClick\"];\nconst _hoisted_8 = {\n  class: \"relative\"\n};\nconst _hoisted_9 = {\n  key: 0,\n  class: \"absolute top-4 left-4 bg-blue-900/80 rounded-lg p-3 text-white text-sm\"\n};\nconst _hoisted_10 = {\n  key: 0\n};\nconst _hoisted_11 = {\n  class: \"text-blue-200 text-xs\"\n};\nconst _hoisted_12 = {\n  key: 1,\n  class: \"absolute inset-0 flex items-center justify-center bg-blue-950/50\"\n};\nconst _hoisted_13 = {\n  class: \"text-center\"\n};\nconst _hoisted_14 = {\n  class: \"text-cyan-400\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"h2\", _hoisted_3, [_createVNode($setup[\"MapPin\"], {\n    class: \"h-5 w-5 mr-2 text-cyan-400\"\n  }), _cache[0] || (_cache[0] = _createTextVNode(\" 交通分布地图 \"))]), _createElementVNode(\"div\", _hoisted_4, [(_openBlock(), _createElementBlock(_Fragment, null, _renderList($setup.mapViews, view => {\n    return _createElementVNode(\"button\", {\n      key: view.key,\n      onClick: $event => $setup.changeMapView(view.key),\n      class: _normalizeClass(['px-3 py-1 rounded-lg text-sm transition-colors duration-300', $setup.currentMapView === view.key ? 'bg-cyan-500 text-white' : 'bg-blue-900 text-blue-200 hover:bg-blue-800'])\n    }, _toDisplayString(view.name), 11 /* TEXT, CLASS, PROPS */, _hoisted_5);\n  }), 64 /* STABLE_FRAGMENT */))])]), _createCommentVNode(\" 地图风格选择器 \"), _createElementVNode(\"div\", _hoisted_6, [(_openBlock(), _createElementBlock(_Fragment, null, _renderList($setup.mapStyles, style => {\n    return _createElementVNode(\"button\", {\n      key: style.key,\n      onClick: $event => $setup.changeMapStyle(style.key),\n      class: _normalizeClass(['px-2 py-1 rounded text-xs transition-colors duration-300', $setup.currentMapStyle === style.key ? 'bg-cyan-500 text-white' : 'bg-blue-900 text-blue-200 hover:bg-blue-800'])\n    }, _toDisplayString(style.name), 11 /* TEXT, CLASS, PROPS */, _hoisted_7);\n  }), 64 /* STABLE_FRAGMENT */))]), _createCommentVNode(\" 地图容器 \"), _createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"div\", {\n    id: $setup.mapContainerId,\n    ref: \"mapContainer\",\n    class: \"rounded-lg overflow-hidden border border-blue-800\",\n    style: {\n      \"min-height\": \"600px\",\n      \"width\": \"100%\",\n      \"height\": \"600px\"\n    }\n  }, null, 512 /* NEED_PATCH */), _createCommentVNode(\" 地图状态信息 \"), $setup.mapLoaded ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [_cache[1] || (_cache[1] = _createElementVNode(\"div\", {\n    class: \"flex items-center mb-1\"\n  }, [_createElementVNode(\"div\", {\n    class: \"w-2 h-2 rounded-full bg-green-400 mr-2\"\n  }), _createElementVNode(\"span\", null, \"地图已加载\")], -1 /* CACHED */)), $props.data && $props.data.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [_createElementVNode(\"p\", null, \"找到 \" + _toDisplayString($props.data.length) + \" 条数据\", 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_11, _toDisplayString($props.vehicleId ? '车辆轨迹模式' : '区域分布模式'), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true)])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 地图控制按钮 \"), _createElementVNode(\"div\", {\n    class: \"absolute top-4 right-4 flex flex-col space-y-2\"\n  }, [_createElementVNode(\"button\", {\n    onClick: $setup.centerToShandong,\n    class: \"bg-blue-900/80 hover:bg-blue-800 text-white text-sm py-1 px-3 rounded-lg\"\n  }, \" 查看山东省 \"), _createElementVNode(\"button\", {\n    onClick: $setup.centerToJinan,\n    class: \"bg-blue-900/80 hover:bg-blue-800 text-white text-sm py-1 px-3 rounded-lg\"\n  }, \" 查看济南市 \")]), _createCommentVNode(\" 加载中状态 \"), $props.loading || !$setup.mapLoaded ? (_openBlock(), _createElementBlock(\"div\", _hoisted_12, [_createElementVNode(\"div\", _hoisted_13, [_cache[2] || (_cache[2] = _createElementVNode(\"div\", {\n    class: \"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-cyan-500 mb-4\"\n  }, null, -1 /* CACHED */)), _createElementVNode(\"p\", _hoisted_14, _toDisplayString($setup.loadingMessage), 1 /* TEXT */)])])) : _createCommentVNode(\"v-if\", true)])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","$setup","_hoisted_4","_Fragment","_renderList","mapViews","view","key","onClick","$event","changeMapView","_normalizeClass","currentMapView","name","_hoisted_5","_createCommentVNode","_hoisted_6","mapStyles","style","changeMapStyle","currentMapStyle","_hoisted_7","_hoisted_8","id","mapContainerId","ref","mapLoaded","_hoisted_9","$props","data","length","_hoisted_10","_toDisplayString","_hoisted_11","vehicleId","centerToShandong","centerToJinan","loading","_hoisted_12","_hoisted_13","_hoisted_14","loadingMessage"],"sources":["E:\\hhh\\frontend\\src\\modules\\trafficVisualization\\TrafficMapPanel.vue"],"sourcesContent":["<template>\r\n  <div class=\"card-tech p-6\">\r\n    <div class=\"flex items-center justify-between mb-4\">\r\n      <h2 class=\"text-xl font-semibold text-white flex items-center\">\r\n        <MapPin class=\"h-5 w-5 mr-2 text-cyan-400\" />\r\n        交通分布地图\r\n      </h2>\r\n      <div class=\"flex space-x-2\">\r\n        <button \r\n          v-for=\"view in mapViews\" \r\n          :key=\"view.key\"\r\n          @click=\"changeMapView(view.key)\"\r\n          :class=\"[\r\n            'px-3 py-1 rounded-lg text-sm transition-colors duration-300',\r\n            currentMapView === view.key \r\n              ? 'bg-cyan-500 text-white' \r\n              : 'bg-blue-900 text-blue-200 hover:bg-blue-800'\r\n          ]\"\r\n        >\r\n          {{ view.name }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- 地图风格选择器 -->\r\n    <div class=\"mb-4 flex flex-wrap gap-2\">\r\n      <button \r\n        v-for=\"style in mapStyles\" \r\n        :key=\"style.key\"\r\n        @click=\"changeMapStyle(style.key)\"\r\n        :class=\"[\r\n          'px-2 py-1 rounded text-xs transition-colors duration-300',\r\n          currentMapStyle === style.key \r\n            ? 'bg-cyan-500 text-white' \r\n            : 'bg-blue-900 text-blue-200 hover:bg-blue-800'\r\n        ]\"\r\n      >\r\n        {{ style.name }}\r\n      </button>\r\n    </div>\r\n    \r\n    <!-- 地图容器 -->\r\n    <div class=\"relative\">\r\n      <div \r\n        :id=\"mapContainerId\" \r\n        ref=\"mapContainer\"\r\n        class=\"rounded-lg overflow-hidden border border-blue-800\"\r\n        style=\"min-height: 600px; width: 100%; height: 600px;\"\r\n      ></div>\r\n      \r\n      <!-- 地图状态信息 -->\r\n      <div v-if=\"mapLoaded\" class=\"absolute top-4 left-4 bg-blue-900/80 rounded-lg p-3 text-white text-sm\">\r\n        <div class=\"flex items-center mb-1\">\r\n          <div class=\"w-2 h-2 rounded-full bg-green-400 mr-2\"></div>\r\n          <span>地图已加载</span>\r\n        </div>\r\n        <div v-if=\"data && data.length > 0\">\r\n          <p>找到 {{ data.length }} 条数据</p>\r\n          <p class=\"text-blue-200 text-xs\">{{ vehicleId ? '车辆轨迹模式' : '区域分布模式' }}</p>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- 地图控制按钮 -->\r\n      <div class=\"absolute top-4 right-4 flex flex-col space-y-2\">\r\n        <button \r\n          @click=\"centerToShandong\"\r\n          class=\"bg-blue-900/80 hover:bg-blue-800 text-white text-sm py-1 px-3 rounded-lg\"\r\n        >\r\n          查看山东省\r\n        </button>\r\n        <button \r\n          @click=\"centerToJinan\"\r\n          class=\"bg-blue-900/80 hover:bg-blue-800 text-white text-sm py-1 px-3 rounded-lg\"\r\n        >\r\n          查看济南市\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- 加载中状态 -->\r\n      <div v-if=\"loading || !mapLoaded\" class=\"absolute inset-0 flex items-center justify-center bg-blue-950/50\">\r\n        <div class=\"text-center\">\r\n          <div class=\"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-cyan-500 mb-4\"></div>\r\n          <p class=\"text-cyan-400\">{{ loadingMessage }}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, onUnmounted, watch, nextTick } from 'vue'\r\nimport { MapPin } from 'lucide-vue-next'\r\n\r\nconst props = defineProps({\r\n  data: {\r\n    type: Array,\r\n    default: () => []\r\n  },\r\n  viewType: {\r\n    type: String,\r\n    default: 'distribution'\r\n  },\r\n  mapStyle: {\r\n    type: String,\r\n    default: 'blue'\r\n  },\r\n  loading: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  vehicleId: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n})\r\n\r\nconst emit = defineEmits(['update:viewType', 'update:mapStyle'])\r\n\r\n// 生成唯一的地图容器ID - 使用更复杂的ID避免冲突\r\nconst mapContainerId = `amap-container-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\r\nconst mapContainer = ref(null)\r\n// 地图实例\r\nlet mapInstance = null\r\nlet currentHeatmap = null // 存储当前热力图实例\r\nconst mapLoaded = ref(false)\r\nconst loadingMessage = ref('正在加载高德地图API...')\r\n\r\n// 地图风格\r\nconst mapStyleOptions = {\r\n  normal: 'amap://styles/normal',\r\n  dark: 'amap://styles/dark',\r\n  light: 'amap://styles/light',\r\n  whitesmoke: 'amap://styles/whitesmoke',\r\n  fresh: 'amap://styles/fresh',\r\n  blue: 'amap://styles/blue',\r\n  darkblue: 'amap://styles/darkblue'\r\n}\r\n\r\n// 地图风格选项\r\nconst mapStyles = [\r\n  { key: 'normal', name: '标准地图' },\r\n  { key: 'dark', name: '暗色地图' },\r\n  { key: 'light', name: '亮色地图' },\r\n  { key: 'whitesmoke', name: '浅灰地图' },\r\n  { key: 'fresh', name: '清新地图' },\r\n  { key: 'blue', name: '蓝色地图' },\r\n  { key: 'darkblue', name: '深蓝地图' }\r\n]\r\n\r\n// 当前地图风格\r\nconst currentMapStyle = ref(props.mapStyle || 'blue')\r\n\r\n// 当前地图视图\r\nconst currentMapView = ref(props.viewType || 'distribution')\r\n\r\n// 地图视图选项\r\nconst mapViews = [\r\n  { key: 'distribution', name: '分布视图' },\r\n  { key: 'trajectory', name: '轨迹视图' },\r\n  { key: 'heatmap', name: '热力图' }\r\n]\r\n\r\n// 视图对应的默认风格\r\nconst viewStyleMap = {\r\n  distribution: 'blue',\r\n  trajectory: 'dark',\r\n  heatmap: 'darkblue'\r\n}\r\n\r\n// 异步加载高德地图API\r\nfunction loadAMapScript() {\r\n  return new Promise((resolve, reject) => {\r\n    if (window.AMap) {\r\n      resolve(window.AMap)\r\n      return\r\n    }\r\n\r\n    loadingMessage.value = '正在加载高德地图API...'\r\n    const script = document.createElement('script')\r\n    script.type = 'text/javascript'\r\n    script.async = true\r\n    script.src = 'https://webapi.amap.com/maps?v=2.0&key=ac9b745946df9aee02cf0515319407df&callback=initAMap'\r\n    \r\n    // 创建全局回调函数\r\n    window.initAMap = () => {\r\n      resolve(window.AMap)\r\n      delete window.initAMap\r\n    }\r\n    \r\n    script.onerror = () => {\r\n      reject(new Error('高德地图API加载失败'))\r\n      loadingMessage.value = '地图API加载失败，请刷新重试'\r\n    }\r\n    \r\n    document.head.appendChild(script)\r\n  })\r\n}\r\n\r\n// 初始化地图\r\nasync function initMap() {\r\n  try {\r\n    // 检查容器是否存在\r\n    if (!mapContainer.value) {\r\n      console.error('地图容器不存在')\r\n      loadingMessage.value = '地图容器不存在，请刷新页面'\r\n      return\r\n    }\r\n    \r\n    // 如果地图实例已存在，先销毁\r\n    if (mapInstance) {\r\n      console.log('销毁现有地图实例')\r\n      mapInstance.destroy()\r\n      mapInstance = null\r\n      currentHeatmap = null\r\n    }\r\n    \r\n    // 确保高德地图API已加载\r\n    if (!window.AMap) {\r\n      loadingMessage.value = '正在加载高德地图API...'\r\n      await loadAMapScript()\r\n    }\r\n    \r\n    loadingMessage.value = '正在初始化地图...'\r\n    console.log(`正在初始化地图，容器ID: ${mapContainerId}`)\r\n    \r\n    // 等待下一个tick确保DOM完全渲染\r\n    await nextTick()\r\n    \r\n    // 再次检查容器\r\n    const containerElement = document.getElementById(mapContainerId)\r\n    if (!containerElement) {\r\n      console.error(`找不到地图容器: ${mapContainerId}`)\r\n      loadingMessage.value = '地图容器初始化失败'\r\n      return\r\n    }\r\n    \r\n    // 创建地图实例\r\n    mapInstance = new window.AMap.Map(mapContainerId, {\r\n      center: [117.120, 36.651], // 济南市中心\r\n      zoom: 8,                   // 缩放级别\r\n      viewMode: '2D',            // 2D模式\r\n      mapStyle: mapStyleOptions[currentMapStyle.value],\r\n      // 添加配置项解决Canvas警告\r\n      features: ['bg', 'road', 'building', 'point'],\r\n      // 禁用某些可能导致Canvas问题的功能\r\n      doubleClickZoom: false,\r\n      // 设置地图渲染模式\r\n      renderMode: 'canvas'\r\n    })\r\n    \r\n    // 添加地图控件\r\n    mapInstance.plugin(['AMap.ToolBar', 'AMap.Scale'], function() {\r\n      mapInstance.addControl(new window.AMap.ToolBar())\r\n      mapInstance.addControl(new window.AMap.Scale())\r\n    })\r\n    \r\n    // 监听地图加载完成事件\r\n    mapInstance.on('complete', function() {\r\n      console.log('地图加载完成')\r\n      mapLoaded.value = true\r\n      // 根据当前视图类型更新地图\r\n      updateMapByViewType(currentMapView.value)\r\n    })\r\n    \r\n    // 监听地图错误事件\r\n    mapInstance.on('error', function(error) {\r\n      console.error('地图加载错误:', error)\r\n      loadingMessage.value = '地图加载错误，请刷新重试'\r\n    })\r\n    \r\n  } catch (error) {\r\n    console.error('地图初始化失败:', error)\r\n    loadingMessage.value = '地图初始化失败，请刷新重试'\r\n  }\r\n}\r\n\r\n// 根据视图类型更新地图\r\nfunction updateMapByViewType(viewType) {\r\n  if (!mapInstance) return\r\n  \r\n  // 根据视图类型设置默认风格\r\n  if (viewStyleMap[viewType]) {\r\n    currentMapStyle.value = viewStyleMap[viewType]\r\n    mapInstance.setMapStyle(mapStyleOptions[currentMapStyle.value])\r\n  }\r\n  \r\n  // 根据不同视图类型执行不同操作\r\n  switch (viewType) {\r\n    case 'distribution':\r\n      // 分布视图逻辑\r\n      renderDistributionView()\r\n      break\r\n    case 'trajectory':\r\n      // 轨迹视图逻辑\r\n      renderTrajectoryView()\r\n      break\r\n    case 'heatmap':\r\n      // 热力图视图逻辑\r\n      renderHeatmapView()\r\n      break\r\n  }\r\n}\r\n\r\n// 切换地图风格\r\nfunction changeMapStyle(styleKey) {\r\n  if (!mapInstance) return\r\n  \r\n  currentMapStyle.value = styleKey\r\n  mapInstance.setMapStyle(mapStyleOptions[styleKey])\r\n  emit('update:mapStyle', styleKey)\r\n}\r\n\r\n// 分布视图渲染\r\nfunction renderDistributionView() {\r\n  if (!mapInstance || !props.data || !props.data.length) return\r\n  \r\n  // 清除已有标记\r\n  mapInstance.clearMap()\r\n  \r\n  // 添加点标记\r\n  props.data.forEach(item => {\r\n    const lat = item.lat || item.latitude\r\n    const lng = item.lng || item.longitude\r\n    \r\n    if (lat && lng) {\r\n      new window.AMap.Marker({\r\n        position: [lng, lat],\r\n        map: mapInstance,\r\n        icon: new window.AMap.Icon({\r\n          size: new window.AMap.Size(6, 6),\r\n          image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSI2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxjaXJjbGUgY3g9IjMiIGN5PSIzIiByPSIzIiBmaWxsPSIjMDBjZmZmIi8+PC9zdmc+',\r\n          imageSize: new window.AMap.Size(6, 6)\r\n        })\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n// 轨迹视图渲染\r\nfunction renderTrajectoryView() {\r\n  if (!mapInstance || !props.data || !props.data.length) return\r\n  \r\n  // 清除已有标记\r\n  mapInstance.clearMap()\r\n  \r\n  // 如果有指定车辆ID，绘制该车辆轨迹\r\n  if (props.vehicleId) {\r\n    const vehicleData = props.data\r\n      .filter(item => item.vehicleId === props.vehicleId || item.vehicle_id === props.vehicleId)\r\n      .sort((a, b) => {\r\n        const timeA = a.timestamp || a.UTC || 0\r\n        const timeB = b.timestamp || b.UTC || 0\r\n        return timeA - timeB\r\n      })\r\n    \r\n    if (vehicleData.length > 1) {\r\n      // 创建轨迹路径\r\n      const path = vehicleData.map(item => {\r\n        const lng = item.lng || item.longitude\r\n        const lat = item.lat || item.latitude\r\n        return [lng, lat]\r\n      })\r\n      \r\n      // 绘制轨迹线\r\n      const polyline = new window.AMap.Polyline({\r\n        path: path,\r\n        strokeColor: '#00cfff',\r\n        strokeWeight: 4,\r\n        strokeOpacity: 0.8,\r\n        showDir: true\r\n      })\r\n      \r\n      mapInstance.add(polyline)\r\n      \r\n      // 添加起点和终点标记\r\n      const startMarker = new window.AMap.Marker({\r\n        position: path[0],\r\n        map: mapInstance,\r\n        icon: new window.AMap.Icon({\r\n          size: new window.AMap.Size(25, 34),\r\n          imageSize: new window.AMap.Size(25, 34),\r\n          image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-marker.png'\r\n        })\r\n      })\r\n      \r\n      const endMarker = new window.AMap.Marker({\r\n        position: path[path.length - 1],\r\n        map: mapInstance,\r\n        icon: new window.AMap.Icon({\r\n          size: new window.AMap.Size(25, 34),\r\n          imageSize: new window.AMap.Size(25, 34),\r\n          image: '//a.amap.com/jsapi_demos/static/demo-center/icons/dir-spot.png'\r\n        })\r\n      })\r\n      \r\n      // 自适应缩放级别\r\n      mapInstance.setFitView([polyline, startMarker, endMarker])\r\n    }\r\n  }\r\n}\r\n\r\n// 热力图视图渲染\r\nfunction renderHeatmapView() {\r\n  if (!mapInstance || !props.data || !props.data.length) return\r\n  \r\n  // 清除已有标记和热力图\r\n  mapInstance.clearMap()\r\n  if (currentHeatmap) {\r\n    currentHeatmap.setMap(null)\r\n    currentHeatmap = null\r\n  }\r\n  \r\n  // 准备热力图数据\r\n  const heatmapData = props.data.map(item => {\r\n    const lng = item.lng || item.longitude\r\n    const lat = item.lat || item.latitude\r\n    const count = item.count || item.speed || 1\r\n    \r\n    return {\r\n      lng: lng,\r\n      lat: lat,\r\n      count: count\r\n    }\r\n  }).filter(item => item.lng && item.lat) // 过滤掉无效数据\r\n  \r\n  if (heatmapData.length === 0) {\r\n    console.warn('没有有效的热力图数据')\r\n    return\r\n  }\r\n  \r\n  // 加载热力图插件\r\n  mapInstance.plugin(['AMap.HeatMap'], function() {\r\n    try {\r\n      // 创建热力图实例\r\n      currentHeatmap = new window.AMap.HeatMap(mapInstance, {\r\n        radius: 25,\r\n        opacity: [0, 0.8],\r\n        gradient: {\r\n          0.5: 'blue',\r\n          0.65: 'rgb(117,211,248)',\r\n          0.7: 'rgb(0,255,0)',\r\n          0.9: 'yellow',\r\n          1.0: 'red'\r\n        },\r\n        // 添加配置减少Canvas警告\r\n        blur: 0.85,\r\n        zooms: [3, 18]\r\n      })\r\n      \r\n      // 设置热力图数据\r\n      currentHeatmap.setDataSet({\r\n        data: heatmapData,\r\n        max: Math.max(...heatmapData.map(item => item.count))\r\n      })\r\n      \r\n      console.log(`热力图渲染完成，共 ${heatmapData.length} 个点`)\r\n    } catch (error) {\r\n      console.error('热力图渲染失败:', error)\r\n    }\r\n  })\r\n}\r\n\r\n// 切换地图视图\r\nfunction changeMapView(viewType) {\r\n  currentMapView.value = viewType\r\n  emit('update:viewType', viewType)\r\n  updateMapByViewType(viewType)\r\n}\r\n\r\n// 定位到山东省\r\nfunction centerToShandong() {\r\n  if (mapInstance) {\r\n    mapInstance.setZoomAndCenter(7, [118.000, 36.400])\r\n  }\r\n}\r\n\r\n// 定位到济南市\r\nfunction centerToJinan() {\r\n  if (mapInstance) {\r\n    mapInstance.setZoomAndCenter(11, [117.120, 36.651])\r\n  }\r\n}\r\n\r\n// 监听视图类型变化\r\nwatch(() => props.viewType, (newView) => {\r\n  if (mapInstance && newView) {\r\n    currentMapView.value = newView\r\n    updateMapByViewType(newView)\r\n  }\r\n})\r\n\r\n// 监听地图风格变化\r\nwatch(() => props.mapStyle, (newStyle) => {\r\n  if (mapInstance && newStyle) {\r\n    currentMapStyle.value = newStyle\r\n    mapInstance.setMapStyle(mapStyleOptions[newStyle])\r\n  }\r\n})\r\n\r\n// 监听交通数据变化\r\nwatch(() => props.data, (newData) => {\r\n  if (mapInstance && newData && newData.length > 0) {\r\n    updateMapByViewType(currentMapView.value)\r\n  }\r\n}, { deep: true })\r\n\r\n// 组件挂载时初始化地图\r\nonMounted(async () => {\r\n  console.log('TrafficMapPanel 组件已挂载')\r\n  \r\n  // 等待DOM完全渲染\r\n  await nextTick()\r\n  \r\n  // 再等待一个短暂的时间确保所有样式都应用完成\r\n  setTimeout(async () => {\r\n    console.log('开始初始化地图')\r\n    await initMap()\r\n  }, 100) // 减少等待时间，但确保DOM已经渲染\r\n})\r\n\r\n// 组件卸载时销毁地图\r\nonUnmounted(() => {\r\n  console.log('TrafficMapPanel 组件已卸载')\r\n  \r\n  // 清理热力图实例\r\n  if (currentHeatmap) {\r\n    try {\r\n      currentHeatmap.setMap(null)\r\n    } catch (error) {\r\n      console.warn('清理热力图失败:', error)\r\n    }\r\n    currentHeatmap = null\r\n  }\r\n  \r\n  // 清理地图实例\r\n  if (mapInstance) {\r\n    try {\r\n      mapInstance.clearMap()\r\n      mapInstance.destroy()\r\n    } catch (error) {\r\n      console.warn('销毁地图实例失败:', error)\r\n    }\r\n    mapInstance = null\r\n  }\r\n  \r\n  // 重置状态\r\n  mapLoaded.value = false\r\n})\r\n</script>\r\n"],"mappings":";;EACOA,KAAK,EAAC;AAAe;;EACnBA,KAAK,EAAC;AAAwC;;EAC7CA,KAAK,EAAC;AAAoD;;EAIzDA,KAAK,EAAC;AAAgB;;;EAkBxBA,KAAK,EAAC;AAA2B;;;EAiBjCA,KAAK,EAAC;AAAU;;;EASGA,KAAK,EAAC;;;;;;EAOrBA,KAAK,EAAC;AAAuB;;;EAqBFA,KAAK,EAAC;;;EACjCA,KAAK,EAAC;AAAa;;EAEnBA,KAAK,EAAC;AAAe;;uBAjFhCC,mBAAA,CAqFM,OArFNC,UAqFM,GApFJC,mBAAA,CAoBM,OApBNC,UAoBM,GAnBJD,mBAAA,CAGK,MAHLE,UAGK,GAFHC,YAAA,CAA6CC,MAAA;IAArCP,KAAK,EAAC;EAA4B,I,2CAAG,UAE/C,G,GACAG,mBAAA,CAcM,OAdNK,UAcM,I,cAbJP,mBAAA,CAYSQ,SAAA,QAAAC,WAAA,CAXQH,MAAA,CAAAI,QAAQ,EAAhBC,IAAI;WADbT,mBAAA,CAYS;MAVNU,GAAG,EAAED,IAAI,CAACC,GAAG;MACbC,OAAK,EAAAC,MAAA,IAAER,MAAA,CAAAS,aAAa,CAACJ,IAAI,CAACC,GAAG;MAC7Bb,KAAK,EAAAiB,eAAA,E,+DAA6FV,MAAA,CAAAW,cAAc,KAAKN,IAAI,CAACC,GAAG,G;wBAO3HD,IAAI,CAACO,IAAI,gCAAAC,UAAA;sCAKlBC,mBAAA,aAAgB,EAChBlB,mBAAA,CAcM,OAdNmB,UAcM,I,cAbJrB,mBAAA,CAYSQ,SAAA,QAAAC,WAAA,CAXSH,MAAA,CAAAgB,SAAS,EAAlBC,KAAK;WADdrB,mBAAA,CAYS;MAVNU,GAAG,EAAEW,KAAK,CAACX,GAAG;MACdC,OAAK,EAAAC,MAAA,IAAER,MAAA,CAAAkB,cAAc,CAACD,KAAK,CAACX,GAAG;MAC/Bb,KAAK,EAAAiB,eAAA,E,4DAAsFV,MAAA,CAAAmB,eAAe,KAAKF,KAAK,CAACX,GAAG,G;wBAOtHW,KAAK,CAACL,IAAI,gCAAAQ,UAAA;oCAIjBN,mBAAA,UAAa,EACblB,mBAAA,CA2CM,OA3CNyB,UA2CM,GA1CJzB,mBAAA,CAKO;IAJJ0B,EAAE,EAAEtB,MAAA,CAAAuB,cAAc;IACnBC,GAAG,EAAC,cAAc;IAClB/B,KAAK,EAAC,mDAAmD;IACzDwB,KAAsD,EAAtD;MAAA;MAAA;MAAA;IAAA;kCAGFH,mBAAA,YAAe,EACJd,MAAA,CAAAyB,SAAS,I,cAApB/B,mBAAA,CASM,OATNgC,UASM,G,0BARJ9B,mBAAA,CAGM;IAHDH,KAAK,EAAC;EAAwB,IACjCG,mBAAA,CAA0D;IAArDH,KAAK,EAAC;EAAwC,IACnDG,mBAAA,CAAkB,cAAZ,OAAK,E,qBAEF+B,MAAA,CAAAC,IAAI,IAAID,MAAA,CAAAC,IAAI,CAACC,MAAM,Q,cAA9BnC,mBAAA,CAGM,OAAAoC,WAAA,GAFJlC,mBAAA,CAA+B,WAA5B,KAAG,GAAAmC,gBAAA,CAAGJ,MAAA,CAAAC,IAAI,CAACC,MAAM,IAAG,MAAI,iBAC3BjC,mBAAA,CAA0E,KAA1EoC,WAA0E,EAAAD,gBAAA,CAAtCJ,MAAA,CAAAM,SAAS,uC,+EAIjDnB,mBAAA,YAAe,EACflB,mBAAA,CAaM;IAbDH,KAAK,EAAC;EAAgD,IACzDG,mBAAA,CAKS;IAJNW,OAAK,EAAEP,MAAA,CAAAkC,gBAAgB;IACxBzC,KAAK,EAAC;KACP,SAED,GACAG,mBAAA,CAKS;IAJNW,OAAK,EAAEP,MAAA,CAAAmC,aAAa;IACrB1C,KAAK,EAAC;KACP,SAED,E,GAGFqB,mBAAA,WAAc,EACHa,MAAA,CAAAS,OAAO,KAAKpC,MAAA,CAAAyB,SAAS,I,cAAhC/B,mBAAA,CAKM,OALN2C,WAKM,GAJJzC,mBAAA,CAGM,OAHN0C,WAGM,G,0BAFJ1C,mBAAA,CAA6G;IAAxGH,KAAK,EAAC;EAA2F,4BACtGG,mBAAA,CAAiD,KAAjD2C,WAAiD,EAAAR,gBAAA,CAArB/B,MAAA,CAAAwC,cAAc,iB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}